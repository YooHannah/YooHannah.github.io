<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="vue,">





  <link rel="alternate" href="/atom.xml" title="My Little World" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243&amp;lt;body&amp;gt;  &amp;lt;div id = &amp;apos;app&amp;apos; class=&amp;apos;hello&amp;apos;&amp;gt;    &amp;lt;p&amp;gt;      &amp;lt;router-link to=&amp;quot;/foo&amp;quot">
<meta name="keywords" content="vue">
<meta property="og:type" content="article">
<meta property="og:title" content="vueRouter 源码">
<meta property="og:url" content="http://yoohannah.github.io/post/vue/vueroutersrc.html">
<meta property="og:site_name" content="My Little World">
<meta property="og:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243&amp;lt;body&amp;gt;  &amp;lt;div id = &amp;apos;app&amp;apos; class=&amp;apos;hello&amp;apos;&amp;gt;    &amp;lt;p&amp;gt;      &amp;lt;router-link to=&amp;quot;/foo&amp;quot">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoohannah.github.io/image/vuerouter.jpg">
<meta property="og:updated_time" content="2024-09-01T03:26:27.611Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vueRouter 源码">
<meta name="twitter:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243&amp;lt;body&amp;gt;  &amp;lt;div id = &amp;apos;app&amp;apos; class=&amp;apos;hello&amp;apos;&amp;gt;    &amp;lt;p&amp;gt;      &amp;lt;router-link to=&amp;quot;/foo&amp;quot">
<meta name="twitter:image" content="http://yoohannah.github.io/image/vuerouter.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoohannah.github.io/post/vue/vueroutersrc.html">





  <title> vueRouter 源码 | My Little World </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">My Little World</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">learn and share</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/vue/vueroutersrc.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                vueRouter 源码
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-19T10:48:15+08:00">
                2020-02-19
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id = &apos;app&apos; class=&apos;hello&apos;&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &lt;router-link to=&quot;/foo&quot;&gt;Go to Foo&lt;/router-link&gt;</span><br><span class="line">      &lt;router-link to=&quot;/bar/user&quot;&gt;Go to Bar&lt;/router-link&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;script type=&quot;text/javascript&quot; src=&quot;vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script type=&quot;text/javascript&quot; src=&quot;vue-router.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    const Foo = &#123; template: &apos;&lt;div&gt;foo&lt;/div&gt;&apos;,mounted()&#123;&#125;&#125;//路由foo组件</span><br><span class="line">    const Bar = &#123; </span><br><span class="line">      template: &apos;&lt;div&gt;bar&lt;div&gt;&#123;&#123;id&#125;&#125;&lt;/div&gt;&lt;a @click=&quot;aa&quot;&gt;go to foo&lt;/a&gt;&lt;/div&gt;&apos;,//路由bar组件</span><br><span class="line">      data()&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          id:&apos;&apos;,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods:&#123;</span><br><span class="line">        aa()&#123;</span><br><span class="line">          console.log(this.$router)</span><br><span class="line">          this.$router.push(&#123;name:&apos;foo&apos;,params:&#123;name:&apos;jck&apos;&#125;&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      mounted()&#123;</span><br><span class="line">        console.log(this.$route,this.$router)</span><br><span class="line">        this.id = this.$route.params.id</span><br><span class="line">      &#125; </span><br><span class="line">      &#125;</span><br><span class="line">    const routes = [</span><br><span class="line">        &#123; path: &apos;/foo/:name&apos;,name:&apos;foo&apos;, component: Foo &#125;,</span><br><span class="line">        &#123; path: &apos;/bar/:id?&apos;,name:&apos;bar&apos;, component: Bar &#125;</span><br><span class="line">      ]</span><br><span class="line">    const router = new VueRouter(&#123;routes&#125;)</span><br><span class="line">    let app = new Vue(&#123;</span><br><span class="line">      el:&apos;#app&apos;,</span><br><span class="line">      data:&#123;&#125;,</span><br><span class="line">      method:&#123;&#125;,</span><br><span class="line">      router,</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h1 id="执行vue-Router-js文件"><a href="#执行vue-Router-js文件" class="headerlink" title="执行vue-Router.js文件"></a>执行vue-Router.js文件</h1><p>引入vue-router之前会先引入vue.js文件，执行会生成vue构造函数,<br>因为vue-router的执行过程会用到vue构造函数这个对象上的方法<br>当代码引入vue-router.js时，里面相应的代码会执行一遍，<br>此时vue构造函数已经生成<br>所以vue-router.js运行后，<br>不仅会生成vue-router的构造对象<br>还会调用vue构造函数上的use方法将与router相关的信息挂到vue构造函数对象上<br>即做一些注册挂载的初始化工作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">(function (global, factory) &#123;</span><br><span class="line">  global.VueRouter = factory());</span><br><span class="line">&#125;(this, function () &#123; &apos;use strict&apos;;</span><br><span class="line">  //vue-router的构造对象</span><br><span class="line">  var VueRouter = function VueRouter (options) &#123; </span><br><span class="line">    if ( options === void 0 ) options = &#123;&#125;;</span><br><span class="line">    //options即new vueRouter时传进来的参数对象，这里只有一个属性即路由配置对象routes</span><br><span class="line">    this.app = null;</span><br><span class="line">    this.apps = [];</span><br><span class="line">    this.options = options;</span><br><span class="line">    this.beforeHooks = [];</span><br><span class="line">    this.resolveHooks = [];</span><br><span class="line">    this.afterHooks = [];</span><br><span class="line">    //该函数会根据路由配合生成路由表，返回两个函数，一个match函数用来匹配路由，另一个addRoutes用来动态增加路由，详见下文具体分析</span><br><span class="line">    this.matcher = createMatcher(options.routes || [], this);</span><br><span class="line">    var mode = options.mode || &apos;hash&apos;;//路由对象模式，没有配置的话默认初始化为&apos;hash&apos;</span><br><span class="line">    //fallback参数用于配置当浏览器不支持 history.pushState 控制路由是否应该回退到 hash 模式</span><br><span class="line">    //默认值为 true 官文：https://router.vuejs.org/zh/api/#fallback</span><br><span class="line">    this.fallback = mode === &apos;history&apos; &amp;&amp; !supportsPushState &amp;&amp; options.fallback !== false;</span><br><span class="line">    if (this.fallback) &#123; //history模式下在不支持pushstate方法且配置允许回退hash的情况下回退hash模式</span><br><span class="line">      mode = &apos;hash&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!inBrowser) &#123; //没有在浏览器中，那应该是在nodejs中，模式重置为abstract</span><br><span class="line">      mode = &apos;abstract&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    this.mode = mode;//模式确定</span><br><span class="line"></span><br><span class="line">    switch (mode) &#123; //初始化history对象，三种类型的history构造函数继承自同一父类构造函数History</span><br><span class="line">      case &apos;history&apos;:</span><br><span class="line">        this.history = new HTML5History(this, options.base);</span><br><span class="line">        break</span><br><span class="line">      case &apos;hash&apos;:</span><br><span class="line">        this.history = new HashHistory(this, options.base, this.fallback);</span><br><span class="line">        break</span><br><span class="line">      case &apos;abstract&apos;:</span><br><span class="line">        this.history = new AbstractHistory(this, options.base);</span><br><span class="line">        break</span><br><span class="line">      default:</span><br><span class="line">        &#123;</span><br><span class="line">          assert(false, (&quot;invalid mode: &quot; + mode));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  VueRouter.install = install;</span><br><span class="line">  VueRouter.version = &apos;3.1.5&apos;;</span><br><span class="line"></span><br><span class="line">  function install (Vue) &#123; &#125; //挂到VueRouter上，被vue.use函数调用</span><br><span class="line"></span><br><span class="line">  if (inBrowser &amp;&amp; window.Vue) &#123; //只在浏览器环境自动挂载，说明在node.js中需要自己调用Vue.use手动挂载</span><br><span class="line">    window.Vue.use(VueRouter);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return VueRouter;</span><br><span class="line"></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></p>
<h2 id="vue-use-与-VueRouter-install"><a href="#vue-use-与-VueRouter-install" class="headerlink" title="vue.use 与 VueRouter.install"></a>vue.use 与 VueRouter.install</h2><p>vue的use方法会调用插件的install方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//在运行initGlobalAPI(Vue)函数时调用initUse挂载到VUE上</span><br><span class="line">Vue.use = function (plugin) &#123;</span><br><span class="line">  var installedPlugins = (this._installedPlugins || (this._installedPlugins = []));//this是指Vue哦</span><br><span class="line">  if (installedPlugins.indexOf(plugin) &gt; -1) &#123; //避免重复挂载</span><br><span class="line">    return this</span><br><span class="line">  &#125;</span><br><span class="line">  //这个方法会从arguments中取出从第一个数以后的所有参数，这里返回空数组===&gt;[]</span><br><span class="line">  var args = toArray(arguments, 1);</span><br><span class="line">  args.unshift(this);//this是vue,将vue传给组件进行初始化 ==&gt;[vue]</span><br><span class="line">  if (typeof plugin.install === &apos;function&apos;) &#123;  //组件定义了plugin.install方法，执行组件plugin.install方法</span><br><span class="line">    plugin.install.apply(plugin, args);</span><br><span class="line">  &#125; else if (typeof plugin === &apos;function&apos;) &#123; //没定义定义plugin.install方法且组件本身是函数，则调用自身</span><br><span class="line">    plugin.apply(null, args);</span><br><span class="line">  &#125;</span><br><span class="line">  installedPlugins.push(plugin);//将插件推入vue对象上的installedPlugins集合中</span><br><span class="line">  return this</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>VueRouter.install方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">function install (Vue) &#123; //挂到VueRouter上，被vue.use函数调用</span><br><span class="line">    if (install.installed &amp;&amp; _Vue === Vue) &#123; return &#125;//避免重复挂载</span><br><span class="line">    install.installed = true;</span><br><span class="line"></span><br><span class="line">    _Vue = Vue;</span><br><span class="line"></span><br><span class="line">    var isDef = function (v) &#123; return v !== undefined; &#125;;</span><br><span class="line"></span><br><span class="line">    var registerInstance = function (vm, callVal) &#123;</span><br><span class="line">      var i = vm.$options._parentVnode;</span><br><span class="line">      if (isDef(i) &amp;&amp; isDef(i = i.data) &amp;&amp; isDef(i = i.registerRouteInstance)) &#123;</span><br><span class="line">        i(vm, callVal);//如果定义了registerRouteInstance就执行</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    //调用vue.mixin方法 将beforeCreate 和 destroyed，两个生命周期函数存到到对应的钩子函数的集合中</span><br><span class="line">    //在执行new vue时会调用callHook执行 beforeCreate相关的钩子函数</span><br><span class="line">    //在vue中执行destroyed钩子函数时，同样也会调用这里定义好的生命周期函数</span><br><span class="line">    Vue.mixin(&#123; </span><br><span class="line">      beforeCreate: function beforeCreate () &#123; //这里this指向vue</span><br><span class="line">        if (isDef(this.$options.router)) &#123;</span><br><span class="line">          this._routerRoot = this;</span><br><span class="line">          this._router = this.$options.router;</span><br><span class="line">          //调用vueRouter对象上的init方法,主要功能是初始化当前路由，设置监听 详见下文</span><br><span class="line">          this._router.init(this);</span><br><span class="line">          Vue.util.defineReactive(this, &apos;_route&apos;, this._router.history.current);</span><br><span class="line">          //defineReactive会对数据进行劫持，进行依赖收集，方便之后页面切换进行监听</span><br><span class="line">        &#125; else &#123;//如果没有在new vue时传进vuerouter对象</span><br><span class="line">          this._routerRoot = (this.$parent &amp;&amp; this.$parent._routerRoot) || this;</span><br><span class="line">        &#125;</span><br><span class="line">        registerInstance(this, this);</span><br><span class="line">      &#125;,</span><br><span class="line">      destroyed: function destroyed () &#123;</span><br><span class="line">        registerInstance(this);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //访问this.$router,返回new vueRouter生成的对象</span><br><span class="line">    Object.defineProperty(Vue.prototype, &apos;$router&apos;, &#123; </span><br><span class="line">      get: function get () &#123; return this._routerRoot._router &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //访问this.$route,当前页面路由对象 this._router.history.current</span><br><span class="line">    Object.defineProperty(Vue.prototype, &apos;$route&apos;, &#123;</span><br><span class="line">      get: function get () &#123; return this._routerRoot._route &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //挂载RouterView，RouterLink两个组件</span><br><span class="line">    Vue.component(&apos;RouterView&apos;, View); </span><br><span class="line">    Vue.component(&apos;RouterLink&apos;, Link);</span><br><span class="line">    //使用vue生命钩子函数合并策略定义路由生命周期钩子函数合并策略 其实就是mergeHook函数</span><br><span class="line">    var strats = Vue.config.optionMergeStrategies;</span><br><span class="line">    // use the same hook merging strategy for route hooks</span><br><span class="line">    strats.beforeRouteEnter = strats.beforeRouteLeave = strats.beforeRouteUpdate = strats.created;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>vueRouter在执行阶段会做以下两件事<br>1.生成vue-router的构造对象<br>2.挂载vuerouter相关信息到vue对象</p>
<p>挂载到vue对象时会做以下几件事<br>1.注入两个生命周期函数：beforeCreate和 destroyed<br>2.指定vue的$router和$route分别指向传进去的vueRouter对象的本身和history.current属性<br>3.挂载RouterView,RouterLink两个组件<br>4.指定路由生命周期函数合并策略使用vue中生命周期函数的合并策略</p>
<p>beforeCreate会在new vue时被调用，主要做以下几件事<br>1.在vue对象上指定与router相关的属性<br>2.调用vuerouter的init方法，初始化当前路由，设置监听<br>3.对当前路由进行数据劫持，进行监听</p>
<p>在new vueRouter时，会做以下几件事<br>1.根据路由配置数组生成路由表，匹配函数以及动态增加路由的函数<br>2.确定路由模式<br>3。根据路由模式创建history属性</p>
<h1 id="一个疑惑"><a href="#一个疑惑" class="headerlink" title="一个疑惑"></a>一个疑惑</h1><p>当跳转的路由带有query或者params时，将其中的值插入到页面中为什么不会引起XSS攻击？<br>因为拿到的值类型都是原始js类型，vue在替换值时只是当做字符串替换，不会进行innerHTML</p>
<h2 id="使用js跳转路由"><a href="#使用js跳转路由" class="headerlink" title="使用js跳转路由"></a>使用js跳转路由</h2><p>比如this.$router.push({name:foo,query:{id:1}})方法跳转路由<br>目的页面拿到的query/params数据，就是调用push函数传入的数据<br>当我们调用push函数时，就是在调用这段代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">VueRouter.prototype.push = function push (location, onComplete, onAbort) &#123;</span><br><span class="line">    var this$1 = this;</span><br><span class="line">    if (!onComplete &amp;&amp; !onAbort &amp;&amp; typeof Promise !== &apos;undefined&apos;) &#123;</span><br><span class="line">      return new Promise(function (resolve, reject) &#123;//进行异步跳转</span><br><span class="line">        this$1.history.push(location, resolve, reject);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; else &#123;//进行同步跳转</span><br><span class="line">      this.history.push(location, onComplete, onAbort);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure></p>
<p>location就是我们传入的参数，没有传入 onComplete, onAbort，所以会进入if分支<br>可见无论进入哪个分支都会调用history对象的push方法<br>由于在new VueRouter对象时，在构造函数中history是根据传入的选项生成的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">var mode = options.mode || &apos;hash&apos;;</span><br><span class="line">  this.fallback = mode === &apos;history&apos; &amp;&amp; !supportsPushState &amp;&amp; options.fallback !== false;</span><br><span class="line">  if (this.fallback) &#123;</span><br><span class="line">    mode = &apos;hash&apos;;</span><br><span class="line">  &#125;</span><br><span class="line">  if (!inBrowser) &#123;</span><br><span class="line">    mode = &apos;abstract&apos;;</span><br><span class="line">  &#125;</span><br><span class="line">  this.mode = mode;</span><br><span class="line"></span><br><span class="line">  switch (mode) &#123;</span><br><span class="line">    case &apos;history&apos;:</span><br><span class="line">      this.history = new HTML5History(this, options.base);</span><br><span class="line">      break</span><br><span class="line">    case &apos;hash&apos;:</span><br><span class="line">      this.history = new HashHistory(this, options.base, this.fallback);</span><br><span class="line">      break</span><br><span class="line">    case &apos;abstract&apos;:</span><br><span class="line">      this.history = new AbstractHistory(this, options.base);</span><br><span class="line">      break</span><br><span class="line">    default:</span><br><span class="line">      &#123;</span><br><span class="line">        assert(false, (&quot;invalid mode: &quot; + mode));</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>所以push方法的实现可能为以下三种情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">HTML5History.prototype.push = function push (location, onComplete, onAbort) &#123;</span><br><span class="line">  var this$1 = this;</span><br><span class="line"></span><br><span class="line">  var ref = this;</span><br><span class="line">  var fromRoute = ref.current;</span><br><span class="line">  this.transitionTo(location, function (route) &#123;</span><br><span class="line">    pushState(cleanPath(this$1.base + route.fullPath));</span><br><span class="line">    handleScroll(this$1.router, route, fromRoute, false);</span><br><span class="line">    onComplete &amp;&amp; onComplete(route);</span><br><span class="line">  &#125;, onAbort);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">HashHistory.prototype.push = function push (location, onComplete, onAbort) &#123;</span><br><span class="line">  var this$1 = this;</span><br><span class="line">  var ref = this;</span><br><span class="line">  var fromRoute = ref.current;</span><br><span class="line">  this.transitionTo(</span><br><span class="line">    location,</span><br><span class="line">    function (route) &#123;</span><br><span class="line">      pushHash(route.fullPath);//更改url</span><br><span class="line">      handleScroll(this$1.router, route, fromRoute, false);</span><br><span class="line">      onComplete &amp;&amp; onComplete(route);</span><br><span class="line">    &#125;,</span><br><span class="line">    onAbort</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line">AbstractHistory.prototype.push = function push (location, onComplete, onAbort) &#123;</span><br><span class="line">  var this$1 = this;</span><br><span class="line">  this.transitionTo(</span><br><span class="line">    location,</span><br><span class="line">    function (route) &#123;</span><br><span class="line">      this$1.stack = this$1.stack.slice(0, this$1.index + 1).concat(route);</span><br><span class="line">      this$1.index++;</span><br><span class="line">      onComplete &amp;&amp; onComplete(route);</span><br><span class="line">    &#125;,</span><br><span class="line">    onAbort</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>可见三种模式下都会调用共同的父类History上的transitionTo方法<br>接下来以HashHistory为基础分析接下来的流程</p>
<p>在HashHistory push调用transitionTo时，<br>传入三个参数：<br>location 即我们调用push时传入的参数<br>onAbort 调用push时没有传入，故该值为undefined<br>第三个参数是一个匿名函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function (route) &#123;</span><br><span class="line">  pushHash(route.fullPath);//更改url</span><br><span class="line">  handleScroll(this$1.router, route, fromRoute, false);//处理页面滚动相关功能</span><br><span class="line">  onComplete &amp;&amp; onComplete(route);//调用push时没有传入onComplete,故onComplete=&gt;undefined,不会被执行</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>可见匿名函数内将来要执行pushHash函数</p>
<h3 id="pushHash函数更改浏览器url"><a href="#pushHash函数更改浏览器url" class="headerlink" title="pushHash函数更改浏览器url"></a>pushHash函数更改浏览器url</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function pushHash (path) &#123;</span><br><span class="line">  if (supportsPushState) &#123; 使用history.pushState更改URl</span><br><span class="line">    pushState(getUrl(path));</span><br><span class="line">  &#125; else &#123;//如果不支持history.pushState则直接更改hash值</span><br><span class="line">    window.location.hash = path;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">function getUrl (path) &#123;</span><br><span class="line">  var href = window.location.href;</span><br><span class="line">  var i = href.indexOf(&apos;#&apos;);</span><br><span class="line">  var base = i &gt;= 0 ? href.slice(0, i) : href;</span><br><span class="line">  return (base + &quot;#&quot; + path)</span><br><span class="line">&#125;</span><br><span class="line">function pushState (url, replace) &#123;</span><br><span class="line">  saveScrollPosition();</span><br><span class="line">  // try...catch the pushState call to get around Safari</span><br><span class="line">  // DOM Exception 18 where it limits to 100 pushState calls</span><br><span class="line">  var history = window.history;</span><br><span class="line">  try &#123;</span><br><span class="line">    if (replace) &#123; //在使用replace函数跳转路由会走该分支，由replaceState函数调用，replace传入为true</span><br><span class="line">      // 保留现有的历史记录状态，因为用户可能会覆盖它</span><br><span class="line">      var stateCopy = extend(&#123;&#125;, history.state);</span><br><span class="line">      stateCopy.key = getStateKey();</span><br><span class="line">      history.replaceState(stateCopy, &apos;&apos;, url); //使用window的history上的方法</span><br><span class="line">    &#125; else &#123; //没有传入replace，故进入该分支</span><br><span class="line">      history.pushState(&#123; key: setStateKey(genStateKey()) &#125;, &apos;&apos;, url);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    window.location[replace ? &apos;replace&apos; : &apos;assign&apos;](url);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以pushHash函数最终的目的是更改浏览器中的url<br>handleScroll函数处理页面滚动状态，这里暂不做深入<br>onComplete 值为undefined,故不执行</p>
<h3 id="transitionTo"><a href="#transitionTo" class="headerlink" title="transitionTo"></a>transitionTo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">History.prototype.transitionTo = function transitionTo (</span><br><span class="line">    location,</span><br><span class="line">    onComplete,</span><br><span class="line">    onAbort</span><br><span class="line">  ) &#123;</span><br><span class="line">    var this$1 = this;</span><br><span class="line">    var route = this.router.match(location, this.current);//得到目的路由的route对象</span><br><span class="line">    this.confirmTransition(...暂时省略));</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>transitionTo函数中第一步就是根据根据当前路由信息和传入的目的路由信息生成目的路由对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var route = this.router.match(location, this.current);</span><br></pre></td></tr></table></figure></p>
<p>location 是我们调用push函数传入的参数，<br>this.current即当前页面路由信息对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">VueRouter.prototype.match = function match (</span><br><span class="line">  raw,</span><br><span class="line">  current,</span><br><span class="line">  redirectedFrom</span><br><span class="line">) &#123;</span><br><span class="line">  return this.matcher.match(raw, current, redirectedFrom)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">this.matcher = createMatcher(options.routes || [], this); //new vuerouter时在构造函数中生成</span><br></pre></td></tr></table></figure>
<h3 id="createMatcher"><a href="#createMatcher" class="headerlink" title="createMatcher"></a>createMatcher</h3><p>createMatcher函数即创造匹配器的函数，主要做三件事<br>1.生成路由表<br>2.生成匹配器，用于将当然路由对象和目的路由信息对象合成目的路由对象<br>3.生成动态添加路由的函数，因这里可以直接使用路由表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">function createMatcher (</span><br><span class="line">  routes,</span><br><span class="line">  router</span><br><span class="line">) &#123;</span><br><span class="line">  var ref = createRouteMap(routes);//根据路由配置生成路由表</span><br><span class="line">  var pathList = ref.pathList;</span><br><span class="line">  var pathMap = ref.pathMap;</span><br><span class="line">  var nameMap = ref.nameMap;</span><br><span class="line"></span><br><span class="line">  function addRoutes (routes) &#123; //动态增加路由</span><br><span class="line">    createRouteMap(routes, pathList, pathMap, nameMap);</span><br><span class="line">  &#125;</span><br><span class="line">  //根据当前路由对象和目的路由信息以及是否重定向等条件合成目的路由对象返回</span><br><span class="line">  function match ( </span><br><span class="line">    raw,</span><br><span class="line">    currentRoute,</span><br><span class="line">    redirectedFrom</span><br><span class="line">  ) &#123;</span><br><span class="line">    //统一路由参数，合并params给到目的路由</span><br><span class="line">    var location = normalizeLocation(raw, currentRoute, false, router);</span><br><span class="line">    var name = location.name;</span><br><span class="line">    if (name) &#123;//走这条分支</span><br><span class="line">      var record = nameMap[name];</span><br><span class="line">      &#123;</span><br><span class="line">        warn(record, (&quot;Route with name &apos;&quot; + name + &quot;&apos; does not exist&quot;));</span><br><span class="line">      &#125;</span><br><span class="line">      if (!record) &#123; return _createRoute(null, location) &#125;</span><br><span class="line">      var paramNames = record.regex.keys //没有在路由path中配置动态参数，keys数组为空</span><br><span class="line">        .filter(function (key) &#123; return !key.optional; &#125;)</span><br><span class="line">        .map(function (key) &#123; return key.name; &#125;);</span><br><span class="line"></span><br><span class="line">      if (typeof location.params !== &apos;object&apos;) &#123;</span><br><span class="line">        location.params = &#123;&#125;; //给location 挂上params</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (currentRoute &amp;&amp; typeof currentRoute.params === &apos;object&apos;) &#123;</span><br><span class="line">        for (var key in currentRoute.params) &#123;//params中有相同key值时，从当前路由将值给到目的路由</span><br><span class="line">          if (!(key in location.params) &amp;&amp; paramNames.indexOf(key) &gt; -1) &#123;</span><br><span class="line">            location.params[key] = currentRoute.params[key];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      //如果path有动态参数，使用params将path补全，//以name发起的跳转，挂上了path</span><br><span class="line">      location.path = fillParams(record.path, location.params, (&quot;named route \&quot;&quot; + name + &quot;\&quot;&quot;));</span><br><span class="line">      return _createRoute(record, location, redirectedFrom) 可知返回一route对象</span><br><span class="line">    &#125; else if (location.path) &#123; //详见link跳转分析</span><br><span class="line">      location.params = &#123;&#125;;</span><br><span class="line">      for (var i = 0; i &lt; pathList.length; i++) &#123;</span><br><span class="line">        var path = pathList[i];</span><br><span class="line">        var record$1 = pathMap[path];</span><br><span class="line">        if (matchRoute(record$1.regex, location.path, location.params)) &#123;</span><br><span class="line">          console.log(location)</span><br><span class="line">          return _createRoute(record$1, location, redirectedFrom)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // no match</span><br><span class="line">    return _createRoute(null, location)</span><br><span class="line">  &#125;</span><br><span class="line">  function redirect () &#123;...对重定向一系列的处理，会返回createRoute()&#125;</span><br><span class="line">  function alias () &#123;...对路由配置中的别名进行处理，会返回createRoute()&#125;</span><br><span class="line">  function _createRoute ( //会生成fullpath</span><br><span class="line">    record,</span><br><span class="line">    location,</span><br><span class="line">    redirectedFrom</span><br><span class="line">  ) &#123;</span><br><span class="line">    if (record &amp;&amp; record.redirect) &#123;</span><br><span class="line">      return redirect(record, redirectedFrom || location)</span><br><span class="line">    &#125;</span><br><span class="line">    if (record &amp;&amp; record.matchAs) &#123;</span><br><span class="line">      return alias(record, location, record.matchAs)</span><br><span class="line">    &#125;</span><br><span class="line">    return createRoute(record, location, redirectedFrom, router)</span><br><span class="line">  &#125;</span><br><span class="line">  return &#123;</span><br><span class="line">    match: match,</span><br><span class="line">    addRoutes: addRoutes</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="路由表生成"><a href="#路由表生成" class="headerlink" title="路由表生成"></a>路由表生成</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">function createRouteMap ( //生成路由表</span><br><span class="line">  routes,</span><br><span class="line">  oldPathList,</span><br><span class="line">  oldPathMap,</span><br><span class="line">  oldNameMap</span><br><span class="line">) &#123;</span><br><span class="line">  // the path list is used to control path matching priority</span><br><span class="line">  var pathList = oldPathList || [];</span><br><span class="line">  // $flow-disable-line</span><br><span class="line">  var pathMap = oldPathMap || Object.create(null);</span><br><span class="line">  // $flow-disable-line</span><br><span class="line">  var nameMap = oldNameMap || Object.create(null);</span><br><span class="line"></span><br><span class="line">  routes.forEach(function (route) &#123;</span><br><span class="line">    addRouteRecord(pathList, pathMap, nameMap, route);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // ensure wildcard(通配符) routes are always at the end</span><br><span class="line">  for (var i = 0, l = pathList.length; i &lt; l; i++) &#123;</span><br><span class="line">    if (pathList[i] === &apos;*&apos;) &#123;</span><br><span class="line">      pathList.push(pathList.splice(i, 1)[0]);</span><br><span class="line">      l--;</span><br><span class="line">      i--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    // warn if routes do not include leading slashes(斜线)</span><br><span class="line">    var found = pathList</span><br><span class="line">    // check for missing leading slash</span><br><span class="line">      .filter(function (path) &#123; return path &amp;&amp; path.charAt(0) !== &apos;*&apos; &amp;&amp; path.charAt(0) !== &apos;/&apos;; &#125;);</span><br><span class="line"></span><br><span class="line">    if (found.length &gt; 0) &#123;</span><br><span class="line">      var pathNames = found.map(function (path) &#123; return (&quot;- &quot; + path); &#125;).join(&apos;\n&apos;);</span><br><span class="line">      warn(false, (&quot;Non-nested routes must include a leading slash character. Fix the following routes: \n&quot; + pathNames));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &#123;</span><br><span class="line">    pathList: pathList,//数组，存放path值的集合</span><br><span class="line">    pathMap: pathMap,//对象，有配置path的路由record集合</span><br><span class="line">    nameMap: nameMap//对象，有配置name的路由record的集合</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//根据配置的路由将其转换成内部使用的路由对象record,并根据配置情况放到不同路由集合(前三个参数)中，</span><br><span class="line">function addRouteRecord ( </span><br><span class="line">  pathList,</span><br><span class="line">  pathMap,</span><br><span class="line">  nameMap,</span><br><span class="line">  route,//具体配置的route</span><br><span class="line">  parent,//用于处理配置了children，被递归调用时传入，</span><br><span class="line">  matchAs</span><br><span class="line">) &#123;</span><br><span class="line">  var path = route.path;</span><br><span class="line">  var name = route.name;</span><br><span class="line"> </span><br><span class="line">  var pathToRegexpOptions =</span><br><span class="line">    route.pathToRegexpOptions || &#123;&#125;;</span><br><span class="line">  var normalizedPath = normalizePath(path, parent, pathToRegexpOptions.strict);</span><br><span class="line"></span><br><span class="line">  if (typeof route.caseSensitive === &apos;boolean&apos;) &#123;</span><br><span class="line">    pathToRegexpOptions.sensitive = route.caseSensitive;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var record = &#123;</span><br><span class="line">    path: normalizedPath,</span><br><span class="line">    regex: compileRouteRegex(normalizedPath, pathToRegexpOptions),</span><br><span class="line">    components: route.components || &#123; default: route.component &#125;,</span><br><span class="line">    instances: &#123;&#125;,</span><br><span class="line">    name: name,</span><br><span class="line">    parent: parent,</span><br><span class="line">    matchAs: matchAs,</span><br><span class="line">    redirect: route.redirect,</span><br><span class="line">    beforeEnter: route.beforeEnter,</span><br><span class="line">    meta: route.meta || &#123;&#125;,</span><br><span class="line">    props:</span><br><span class="line">      route.props == null</span><br><span class="line">        ? &#123;&#125;</span><br><span class="line">        : route.components</span><br><span class="line">          ? route.props</span><br><span class="line">          : &#123; default: route.props &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  if (route.children) &#123;...&#125;</span><br><span class="line"></span><br><span class="line">  if (!pathMap[record.path]) &#123;</span><br><span class="line">    pathList.push(record.path);</span><br><span class="line">    pathMap[record.path] = record;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (route.alias !== undefined) &#123;...&#125;</span><br><span class="line"></span><br><span class="line">  if (name) &#123;</span><br><span class="line">    if (!nameMap[name]) &#123;</span><br><span class="line">      nameMap[name] = record;</span><br><span class="line">    &#125; else if ( !matchAs) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        false,</span><br><span class="line">        &quot;Duplicate named routes definition: &quot; +</span><br><span class="line">          &quot;&#123; name: \&quot;&quot; + name + &quot;\&quot;, path: \&quot;&quot; + (record.path) + &quot;\&quot; &#125;&quot;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="合并params"><a href="#合并params" class="headerlink" title="合并params"></a>合并params</h3><p>在match函数中首先会整理参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">function normalizeLocation (</span><br><span class="line">   raw,</span><br><span class="line">   current,</span><br><span class="line">   append,</span><br><span class="line">   router</span><br><span class="line"> ) &#123;</span><br><span class="line">   //link标签点击传入的raw是to标签指令的值， 为字符串</span><br><span class="line">   var next = typeof raw === &apos;string&apos; ? &#123; path: raw &#125; : raw;</span><br><span class="line">   // named target</span><br><span class="line">   if (next._normalized) &#123;//已经处理过</span><br><span class="line">     return next</span><br><span class="line">   &#125; else if (next.name) &#123; //当前调用push使用name标记路由，只会走这个分支</span><br><span class="line">     next = extend(&#123;&#125;, raw);</span><br><span class="line">     var params = next.params;</span><br><span class="line">     if (params &amp;&amp; typeof params === &apos;object&apos;) &#123;</span><br><span class="line">       next.params = extend(&#123;&#125;, params);</span><br><span class="line">     &#125;</span><br><span class="line">     return next</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // relative params</span><br><span class="line">   if (!next.path &amp;&amp; next.params &amp;&amp; current) &#123;</span><br><span class="line">     next = extend(&#123;&#125;, next);</span><br><span class="line">     next._normalized = true;</span><br><span class="line">     var params$1 = extend(extend(&#123;&#125;, current.params), next.params);</span><br><span class="line">     if (current.name) &#123;</span><br><span class="line">       next.name = current.name;</span><br><span class="line">       next.params = params$1;</span><br><span class="line">     &#125; else if (current.matched.length) &#123;</span><br><span class="line">       var rawPath = current.matched[current.matched.length - 1].path;</span><br><span class="line">       next.path = fillParams(rawPath, params$1, (&quot;path &quot; + (current.path)));</span><br><span class="line">     &#125; else &#123;</span><br><span class="line">       warn(false, &quot;relative params navigation requires a current route.&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">     return next</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   var parsedPath = parsePath(next.path || &apos;&apos;);</span><br><span class="line">   var basePath = (current &amp;&amp; current.path) || &apos;/&apos;;</span><br><span class="line">   var path = parsedPath.path</span><br><span class="line">     ? resolvePath(parsedPath.path, basePath, append || next.append)</span><br><span class="line">     : basePath;</span><br><span class="line"></span><br><span class="line">   var query = resolveQuery(</span><br><span class="line">     parsedPath.query,</span><br><span class="line">     next.query,</span><br><span class="line">     router &amp;&amp; router.options.parseQuery</span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">   var hash = next.hash || parsedPath.hash;</span><br><span class="line">   if (hash &amp;&amp; hash.charAt(0) !== &apos;#&apos;) &#123;</span><br><span class="line">     hash = &quot;#&quot; + hash;</span><br><span class="line">   &#125;</span><br><span class="line">   return &#123;</span><br><span class="line">     _normalized: true,</span><br><span class="line">     path: path,</span><br><span class="line">     query: query,</span><br><span class="line">     hash: hash</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="创建路由route对象"><a href="#创建路由route对象" class="headerlink" title="创建路由route对象"></a>创建路由route对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">function createRoute (</span><br><span class="line">  record,</span><br><span class="line">  location,</span><br><span class="line">  redirectedFrom,</span><br><span class="line">  router</span><br><span class="line">) &#123;</span><br><span class="line">  var stringifyQuery = router &amp;&amp; router.options.stringifyQuery;</span><br><span class="line"></span><br><span class="line">  var query = location.query || &#123;&#125;;</span><br><span class="line">  try &#123;</span><br><span class="line">    query = clone(query);</span><br><span class="line">  &#125; catch (e) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  var route = &#123;</span><br><span class="line">    name: location.name || (record &amp;&amp; record.name),</span><br><span class="line">    meta: (record &amp;&amp; record.meta) || &#123;&#125;,</span><br><span class="line">    path: location.path || &apos;/&apos;,</span><br><span class="line">    hash: location.hash || &apos;&apos;,</span><br><span class="line">    query: query,//调用push函数传递进来的query，赋值时只能赋值js数据类型，拿到的也是js数据类型</span><br><span class="line">    params: location.params || &#123;&#125;,</span><br><span class="line">    fullPath: getFullPath(location, stringifyQuery),//生成fullPath</span><br><span class="line">    matched: record ? formatMatch(record) : []</span><br><span class="line">  &#125;;</span><br><span class="line">  if (redirectedFrom) &#123;</span><br><span class="line">    route.redirectedFrom = getFullPath(redirectedFrom, stringifyQuery);</span><br><span class="line">  &#125;</span><br><span class="line">  return Object.freeze(route) //禁止改动route对象</span><br><span class="line">&#125;</span><br><span class="line">function getFullPath ( //根据query生成fullPath</span><br><span class="line">    ref,</span><br><span class="line">    _stringifyQuery</span><br><span class="line">  ) &#123;</span><br><span class="line">    var path = ref.path;</span><br><span class="line">    var query = ref.query; if ( query === void 0 ) query = &#123;&#125;;</span><br><span class="line">    var hash = ref.hash; if ( hash === void 0 ) hash = &apos;&apos;;</span><br><span class="line"></span><br><span class="line">    var stringify = _stringifyQuery || stringifyQuery;</span><br><span class="line">    return (path || &apos;/&apos;) + stringify(query) + hash</span><br><span class="line">  &#125;</span><br><span class="line">//组装url上参数的部分</span><br><span class="line">function stringifyQuery (obj) &#123;</span><br><span class="line">  var res = obj ? Object.keys(obj).map(function (key) &#123;</span><br><span class="line">    var val = obj[key];</span><br><span class="line"></span><br><span class="line">    if (val === undefined) &#123;</span><br><span class="line">      return &apos;&apos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (val === null) &#123;</span><br><span class="line">      return encode(key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (Array.isArray(val)) &#123;</span><br><span class="line">      var result = [];</span><br><span class="line">      val.forEach(function (val2) &#123;</span><br><span class="line">        if (val2 === undefined) &#123;</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line">        if (val2 === null) &#123;</span><br><span class="line">          result.push(encode(key));</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          result.push(encode(key) + &apos;=&apos; + encode(val2));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      return result.join(&apos;&amp;&apos;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return encode(key) + &apos;=&apos; + encode(val)</span><br><span class="line">  &#125;).filter(function (x) &#123; return x.length &gt; 0; &#125;).join(&apos;&amp;&apos;) : null;</span><br><span class="line">  return res ? (&quot;?&quot; + res) : &apos;&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以在调用完match之后会得到route,接着会调用confirmTransition</p>
<h3 id="confirmTransition"><a href="#confirmTransition" class="headerlink" title="confirmTransition"></a>confirmTransition</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">在transitionTo调用时</span><br><span class="line">this.confirmTransition(</span><br><span class="line">  route,</span><br><span class="line">  function () &#123;</span><br><span class="line">    this$1.updateRoute(route);//更新router对象</span><br><span class="line">    onComplete &amp;&amp; onComplete(route);//调用transitionTo时传入的第二个参数函数，里面有pushHash来更改url</span><br><span class="line">    this$1.ensureURL();</span><br><span class="line"></span><br><span class="line">    // fire ready cbs once</span><br><span class="line">    if (!this$1.ready) &#123;</span><br><span class="line">      this$1.ready = true;</span><br><span class="line">      this$1.readyCbs.forEach(function (cb) &#123;</span><br><span class="line">        cb(route);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  function (err) &#123;</span><br><span class="line">    if (onAbort) &#123;</span><br><span class="line">      onAbort(err);</span><br><span class="line">    &#125;</span><br><span class="line">    if (err &amp;&amp; !this$1.ready) &#123;</span><br><span class="line">      this$1.ready = true;</span><br><span class="line">      this$1.readyErrorCbs.forEach(function (cb) &#123;</span><br><span class="line">        cb(err);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">History.prototype.confirmTransition = function confirmTransition (route, onComplete, onAbort) &#123;</span><br><span class="line">  var this$1 = this;</span><br><span class="line"></span><br><span class="line">  var current = this.current;</span><br><span class="line">  var abort = function (err) &#123;</span><br><span class="line">    // after merging https://github.com/vuejs/vue-router/pull/2771 we</span><br><span class="line">    // When the user navigates through history through back/forward buttons</span><br><span class="line">    // we do not want to throw the error. We only throw it if directly calling</span><br><span class="line">    // push/replace. That&apos;s why it&apos;s not included in isError</span><br><span class="line">    if (!isExtendedError(NavigationDuplicated, err) &amp;&amp; isError(err)) &#123;</span><br><span class="line">      if (this$1.errorCbs.length) &#123;</span><br><span class="line">        this$1.errorCbs.forEach(function (cb) &#123;</span><br><span class="line">          cb(err);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        warn(false, &apos;uncaught error during route navigation:&apos;);</span><br><span class="line">        console.error(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    onAbort &amp;&amp; onAbort(err);</span><br><span class="line">  &#125;;</span><br><span class="line">  if (</span><br><span class="line">    isSameRoute(route, current) &amp;&amp;</span><br><span class="line">    // in the case the route map has been dynamically appended to</span><br><span class="line">    route.matched.length === current.matched.length</span><br><span class="line">  ) &#123;</span><br><span class="line">    this.ensureURL();</span><br><span class="line">    return abort(new NavigationDuplicated(route))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var ref = resolveQueue(</span><br><span class="line">    this.current.matched,</span><br><span class="line">    route.matched</span><br><span class="line">  );</span><br><span class="line">    var updated = ref.updated;</span><br><span class="line">    var deactivated = ref.deactivated;</span><br><span class="line">    var activated = ref.activated;</span><br><span class="line"></span><br><span class="line">  var queue = [].concat(</span><br><span class="line">    // in-component leave guards</span><br><span class="line">    extractLeaveGuards(deactivated),</span><br><span class="line">    // global before hooks</span><br><span class="line">    this.router.beforeHooks,</span><br><span class="line">    // in-component update hooks</span><br><span class="line">    extractUpdateHooks(updated),</span><br><span class="line">    // in-config enter guards</span><br><span class="line">    activated.map(function (m) &#123; return m.beforeEnter; &#125;),</span><br><span class="line">    // async components</span><br><span class="line">    resolveAsyncComponents(activated)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  this.pending = route;</span><br><span class="line">  var iterator = function (hook, next) &#123;</span><br><span class="line">    if (this$1.pending !== route) &#123;</span><br><span class="line">      return abort()</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">      hook(route, current, function (to) &#123;</span><br><span class="line">        if (to === false || isError(to)) &#123;</span><br><span class="line">          // next(false) -&gt; abort navigation, ensure current URL</span><br><span class="line">          this$1.ensureURL(true);</span><br><span class="line">          abort(to);</span><br><span class="line">        &#125; else if (</span><br><span class="line">          typeof to === &apos;string&apos; ||</span><br><span class="line">          (typeof to === &apos;object&apos; &amp;&amp;</span><br><span class="line">            (typeof to.path === &apos;string&apos; || typeof to.name === &apos;string&apos;))</span><br><span class="line">        ) &#123;</span><br><span class="line">          // next(&apos;/&apos;) or next(&#123; path: &apos;/&apos; &#125;) -&gt; redirect</span><br><span class="line">          abort();</span><br><span class="line">          if (typeof to === &apos;object&apos; &amp;&amp; to.replace) &#123;</span><br><span class="line">            this$1.replace(to);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this$1.push(to);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          // confirm transition and pass on the value</span><br><span class="line">          next(to);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      abort(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  runQueue(queue, iterator, function () &#123;</span><br><span class="line">    var postEnterCbs = [];</span><br><span class="line">    var isValid = function () &#123; return this$1.current === route; &#125;;</span><br><span class="line">    // wait until async components are resolved before</span><br><span class="line">    // extracting in-component enter guards</span><br><span class="line">    var enterGuards = extractEnterGuards(activated, postEnterCbs, isValid);</span><br><span class="line">    var queue = enterGuards.concat(this$1.router.resolveHooks);</span><br><span class="line">    runQueue(queue, iterator, function () &#123;</span><br><span class="line">      if (this$1.pending !== route) &#123;</span><br><span class="line">        return abort()</span><br><span class="line">      &#125;</span><br><span class="line">      this$1.pending = null;</span><br><span class="line">      onComplete(route);//所有需要运行的钩子函数运行完执行更改url,更新current,处理页面滚动</span><br><span class="line">      if (this$1.router.app) &#123;</span><br><span class="line">        this$1.router.app.$nextTick(function () &#123;</span><br><span class="line">          postEnterCbs.forEach(function (cb) &#123;</span><br><span class="line">            cb();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"> function runQueue (queue, fn, cb) &#123;</span><br><span class="line">  var step = function (index) &#123;</span><br><span class="line">    if (index &gt;= queue.length) &#123;</span><br><span class="line">      cb();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      if (queue[index]) &#123;</span><br><span class="line">        fn(queue[index], function () &#123;</span><br><span class="line">          step(index + 1);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        step(index + 1);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  step(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">History.prototype.updateRoute = function updateRoute (route) &#123;</span><br><span class="line">  var prev = this.current;</span><br><span class="line">  this.current = route;</span><br><span class="line">  this.cb &amp;&amp; this.cb(route); //通知app更改_route属性值，即更改$route值</span><br><span class="line">  this.router.afterHooks.forEach(function (hook) &#123;</span><br><span class="line">    hook &amp;&amp; hook(route, prev);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">this.cb在install的时候被定义如果获取</span><br><span class="line">History.prototype.listen = function listen (cb) &#123;</span><br><span class="line">  this.cb = cb;</span><br><span class="line">&#125;;</span><br><span class="line">//在new vue时被定义</span><br><span class="line">VueRouter.prototype.init = function init (app ) &#123;</span><br><span class="line">  history.listen(function (route) &#123;</span><br><span class="line">    this$1.apps.forEach(function (app) &#123;</span><br><span class="line">      app._route = route;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">//install的时候</span><br><span class="line">function install (Vue) &#123;</span><br><span class="line">  Object.defineProperty(Vue.prototype, &apos;$route&apos;, &#123;</span><br><span class="line">    get: function get () &#123; return this._routerRoot._route &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="link标签跳转路由"><a href="#link标签跳转路由" class="headerlink" title="link标签跳转路由"></a>link标签跳转路由</h2><p>点击link标签时，根据绑定函数即可知道，同样会调用router.push<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">var router = this.$router;</span><br><span class="line">var current = this.$route;</span><br><span class="line">var ref = router.resolve(</span><br><span class="line">  this.to,</span><br><span class="line">  current,</span><br><span class="line">  this.append</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">var location = ref.location;</span><br><span class="line">var route = ref.route;</span><br><span class="line">var href = ref.href;</span><br><span class="line"></span><br><span class="line">var handler = function (e) &#123;</span><br><span class="line">  if (guardEvent(e)) &#123;</span><br><span class="line">    if (this$1.replace) &#123;</span><br><span class="line">      router.replace(location, noop);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      router.push(location, noop);//push,直接走同步流程</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var on = &#123; click: guardEvent &#125;;</span><br><span class="line">if (Array.isArray(this.event)) &#123;</span><br><span class="line">  this.event.forEach(function (e) &#123;</span><br><span class="line">    on[e] = handler;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  on[this.event] = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中，经过resolve处理过的to标签属性的值，会生成统一规范的后续需要使用的location,route<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">VueRouter.prototype.resolve = function resolve (</span><br><span class="line">  to,</span><br><span class="line">  current,</span><br><span class="line">  append</span><br><span class="line">) &#123;</span><br><span class="line">  current = current || this.history.current;</span><br><span class="line">  var location = normalizeLocation(</span><br><span class="line">    to,</span><br><span class="line">    current,</span><br><span class="line">    append,</span><br><span class="line">    this</span><br><span class="line">  );</span><br><span class="line">  var route = this.match(location, current);</span><br><span class="line">  var fullPath = route.redirectedFrom || route.fullPath;</span><br><span class="line">  var base = this.history.base;</span><br><span class="line">  var href = createHref(base, fullPath, this.mode);</span><br><span class="line">  return &#123;</span><br><span class="line">    location: location,</span><br><span class="line">    route: route,</span><br><span class="line">    href: href,</span><br><span class="line">    // for backwards compat</span><br><span class="line">    normalizedTo: location,</span><br><span class="line">    resolved: route</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>location 会在normalizeLocation中以第三个return的位置返回如下结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  _normalized: true,</span><br><span class="line">  path: path,</span><br><span class="line">  query: query,</span><br><span class="line">  hash: hash</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样相当于提前normalizeLocation调用，所以在match再调用的时候直接返回自身<br>在接下来的match流程中,会进入以path为依据的流程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">else if (location.path) &#123;</span><br><span class="line">  location.params = &#123;&#125;;</span><br><span class="line">  for (var i = 0; i &lt; pathList.length; i++) &#123;</span><br><span class="line">    var path = pathList[i];</span><br><span class="line">    var record$1 = pathMap[path];//根据path拿到record对象</span><br><span class="line">    if (matchRoute(record$1.regex, location.path, location.params)) &#123;</span><br><span class="line">      return _createRoute(record$1, location, redirectedFrom)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>根据标签to赋予的path值，和生成路由表时拿到的path配置值，根据正则表达式解析params对象，<br>也说明了，为什么跳转路包含动态参数的path时，要跟params配对使用</p>
<h3 id="matchRoute"><a href="#matchRoute" class="headerlink" title="matchRoute"></a>matchRoute</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">function matchRoute (</span><br><span class="line">    regex,</span><br><span class="line">    path,</span><br><span class="line">    params</span><br><span class="line">  ) &#123;</span><br><span class="line">    var m = path.match(regex);</span><br><span class="line">    if (!m) &#123;//当前路由不符合route定义时格式</span><br><span class="line">      return false</span><br><span class="line">    &#125; else if (!params) &#123;</span><br><span class="line">      return true</span><br><span class="line">    &#125;</span><br><span class="line">    //匹配路由组装params</span><br><span class="line">    for (var i = 1, len = m.length; i &lt; len; ++i) &#123;</span><br><span class="line">      var key = regex.keys[i - 1];</span><br><span class="line">      var val = typeof m[i] === &apos;string&apos; ? decodeURIComponent(m[i]) : m[i];//始终为子字符串</span><br><span class="line">      if (key) &#123;</span><br><span class="line">        // Fix #1994: using * with props: true generates a param named 0</span><br><span class="line">        params[key.name || &apos;pathMatch&apos;] = val;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return true</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="直接更改url跳转"><a href="#直接更改url跳转" class="headerlink" title="直接更改url跳转"></a>直接更改url跳转</h2><p>在浏览器直接更改含有动态路由的的url，回车跳转，会根据事先绑定的监听事件进行解析处理<br>在new vue时初始化完当前路由，以执行回调的方式绑定监听<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  VueRouter.prototype.init = function init (app /* Vue component instance */) &#123;</span><br><span class="line">  var this$1 = this;</span><br><span class="line"></span><br><span class="line">  this.app = app;</span><br><span class="line"></span><br><span class="line">  var history = this.history;</span><br><span class="line"></span><br><span class="line">  if (history instanceof HTML5History) &#123; //h5history在new h5history时，在构造函数中设置popstate事件监听</span><br><span class="line">    history.transitionTo(history.getCurrentLocation());</span><br><span class="line">  &#125; else if (history instanceof HashHistory) &#123;</span><br><span class="line">    var setupHashListener = function () &#123;</span><br><span class="line">      history.setupListeners();//设置监听</span><br><span class="line">    &#125;;</span><br><span class="line">    history.transitionTo( //无论成功与否都绑定</span><br><span class="line">      history.getCurrentLocation(),</span><br><span class="line">      setupHashListener, </span><br><span class="line">      setupHashListener</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  history.listen(function (route) &#123; //route改变时调用，this.cb</span><br><span class="line">    this$1.apps.forEach(function (app) &#123;</span><br><span class="line">      app._route = route;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>设置监听具体内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">HashHistory.prototype.setupListeners = function setupListeners () &#123;</span><br><span class="line">    var this$1 = this;</span><br><span class="line"></span><br><span class="line">    var router = this.router;</span><br><span class="line">    var expectScroll = router.options.scrollBehavior;</span><br><span class="line">    var supportsScroll = supportsPushState &amp;&amp; expectScroll;</span><br><span class="line"></span><br><span class="line">    if (supportsScroll) &#123;</span><br><span class="line">      setupScroll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    window.addEventListener(</span><br><span class="line">      supportsPushState ? &apos;popstate&apos; : &apos;hashchange&apos;,</span><br><span class="line">      function () &#123;</span><br><span class="line">        var current = this$1.current;</span><br><span class="line">        if (!ensureSlash()) &#123;</span><br><span class="line">          return</span><br><span class="line">      &#125;</span><br><span class="line">       //直接调用transitionTo进行路由更新</span><br><span class="line">      this$1.transitionTo(getHash(), function (route) &#123; //成功回调不用pushHash更新url</span><br><span class="line">        if (supportsScroll) &#123;</span><br><span class="line">          handleScroll(this$1.router, route, current, true);</span><br><span class="line">        &#125;</span><br><span class="line">        if (!supportsPushState) &#123;</span><br><span class="line">          replaceHash(route.fullPath);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>可见通过监听事件触发的路由改变会直接调用transitionTo函数进行跳转</p>
<h1 id="两个收获"><a href="#两个收获" class="headerlink" title="两个收获"></a>两个收获</h1><p>1.normalizeLocation函数发挥的作用，根据第一参数location对象不同的属性状态进行不同的处理，用于在上游的不同情境(不同方式导致跳转)使用中统一调用<br>2.在transitionTo函数中调用comfirmTransition,为什么不直接在transitionTo函数中书写confirmTransition函数内容呢，为什么要单独摘出来呢？同样，comfirmTransition函数不止会在transition中调用,<br>还会在AbstractHistory的go函数中被直接调用，HashHistory和HTML5History的go方法会直接使用window.history.go(n);nodejs全局对象是global,不是windows,所以需要特殊处理</p>
<p><img src="/image/vuerouter.jpg" alt="vuerouter"></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vue/" rel="tag"># vue</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/vue/vuex1.html" rel="next" title="vuex 一些api使用规则">
                <i class="fa fa-chevron-left"></i> vuex 一些api使用规则
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/knowledge/editionproblem.html" rel="prev" title="一个发版问题">
                一个发版问题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/psb.jpg" alt="YooHannah">
          <p class="site-author-name" itemprop="name">YooHannah</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">263</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#执行vue-Router-js文件"><span class="nav-number">1.</span> <span class="nav-text">执行vue-Router.js文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#vue-use-与-VueRouter-install"><span class="nav-number">1.1.</span> <span class="nav-text">vue.use 与 VueRouter.install</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结"><span class="nav-number">1.2.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#一个疑惑"><span class="nav-number">2.</span> <span class="nav-text">一个疑惑</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用js跳转路由"><span class="nav-number">2.1.</span> <span class="nav-text">使用js跳转路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pushHash函数更改浏览器url"><span class="nav-number">2.1.1.</span> <span class="nav-text">pushHash函数更改浏览器url</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#transitionTo"><span class="nav-number">2.1.2.</span> <span class="nav-text">transitionTo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#createMatcher"><span class="nav-number">2.1.3.</span> <span class="nav-text">createMatcher</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由表生成"><span class="nav-number">2.1.4.</span> <span class="nav-text">路由表生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#合并params"><span class="nav-number">2.1.5.</span> <span class="nav-text">合并params</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建路由route对象"><span class="nav-number">2.1.6.</span> <span class="nav-text">创建路由route对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#confirmTransition"><span class="nav-number">2.1.7.</span> <span class="nav-text">confirmTransition</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#link标签跳转路由"><span class="nav-number">2.2.</span> <span class="nav-text">link标签跳转路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#matchRoute"><span class="nav-number">2.2.1.</span> <span class="nav-text">matchRoute</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直接更改url跳转"><span class="nav-number">2.3.</span> <span class="nav-text">直接更改url跳转</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#两个收获"><span class="nav-number">3.</span> <span class="nav-text">两个收获</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YooHannah</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/treedocument/treedocument.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
