<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="My Little World" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta property="og:type" content="website">
<meta property="og:title" content="My Little World">
<meta property="og:url" content="http://yoohannah.github.io/page/12/index.html">
<meta property="og:site_name" content="My Little World">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="My Little World">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoohannah.github.io/page/12/">





  <title> My Little World </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">My Little World</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">learn and share</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/react/course/construct.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/react/course/construct.html" itemprop="url">
                  构建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-04T21:05:37+08:00">
                2018-12-04
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="UI库"><a href="#UI库" class="headerlink" title="UI库"></a>UI库</h1><p>ant design 适合企业级应用，复杂交付，密集数据展示<br>material UI：时尚，花哨，具有的美观性，更适合开发面向消费者的应用（google版原始react实现）<br>sematic UI:把UI当做一种language来描述（jquery版原始react实现）</p>
<p>选择UI库的考虑因素</p>
<ol>
<li>组件库是否齐全（齐全的话可以减少很多工作量，不用自己实现）</li>
<li>样式风格是否符合业务需求（企业级应用一般要求简洁明了，对于密集性数据展示比较合理；对于移动端面向消费者一般要求好看，button，字体比较大）</li>
<li>API 设计是否便捷和灵活（使用起来是否方便，从而会影响开发效率）</li>
<li>技术支持是否完善（技术文档是否齐全；github上提issue时，能不能得到快速解答）</li>
<li>开发是否活跃（是否有稳定团队在进行快速迭代和维护，在遇到BUG或者需要新功能时可以得到满足）</li>
</ol>
<h1 id="使用next-js-构建react-同构应用"><a href="#使用next-js-构建react-同构应用" class="headerlink" title="使用next.js 构建react 同构应用"></a>使用next.js 构建react 同构应用</h1><p>同构应用：浏览器第一次向服务器请求页面时，服务器返回解析好的页面，不需要浏览器执行js来进行渲染（这样可以加快页面首次打开的速度），之后页面的操作/切换，像单页面一样，不需要浏览器刷新，均由前端完成，包括UI渲染，页面路由切换等，不需要再向服务端请求页面</p>
<p>next.js的几个规则<br>1.页面就是pages目录下的一个组件<br>所有页面放在pages文件夹下，一个页面即一个组件，文件名和文件路径对应路由路径<br>2.static目录映射静态文件（图片）<br>3.page具有特殊静态方法 getInitialProps<br>next.js提供给react组件初始化props的方法</p>
<p>命令行装包：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save react react-dom next</span><br></pre></td></tr></table></figure></p>
<p>在页面中使用其它 react 组件<br>1.页面也是标准的node模块,可使用其它 react组件<br>2.页面会针对性打包,仅包含其引入的组件<br>,不会加载其他额外的资源</p>
<p>所有组件放在components文件夹下，在pages文件夹下的页面js中使用时，直接用路径import进去</p>
<p>使用Link实现同构路由</p>
<p>1.使用 next/link 定义链接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import Link from &apos;next/link&apos;</span><br><span class="line">export default ()=&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;Link href=&apos;/about&apos;&gt;&lt;a&gt;here&lt;/a&gt;&lt;/Link&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>2.点击链接时页面不会刷新<br>如果使用a标签会产生刷新</p>
<p>3.使用 prefatch预加载目标资源<br>如果不添加该属性，则链接对应的组件，在切换的时候再加载相应页面打包的内容，有该属性，则next.js 打包时就会获取所有链接对应的组件，会预加载所有的js内容，从而提高页面切换速度，但是并不会预加载需要从服务器端API请求的数据</p>
<p>4.使用 replace 属性替换 url<br>替换当前页在路由中的history,无法后退回当前页</p>
<p>动态加载页面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import dynamic from &apos;next/dynamic&apos;</span><br><span class="line">const DynamicComponet=dynamic(import(&apos;../components/hello&apos;))</span><br><span class="line">export default ()=&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;DynamicComponet/&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>页面在加载时，除了加载整个页面的main.js,还会加载动态加载的组件的js包，当这个动态组件被render的时候才会被加载</p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>react 让前端单元测试变得容易<br>1.react 应用很少需要访问浏览器 API<br>2.虚拟 Dom 可以在 NodeJs 环境运行和测试 （不需要浏览器环境，在内存中render虚拟DOM即可完成测试）<br>3.Redux隔离了状态管理,纯数据层单元测试</p>
<p>单元测试涉及的工具<br>1.Jest: Facebook 开源的 JS 单元测试框架 （零配置，可以直接开始测试）<br>2.JS dom浏览器环境的 NodeJS 模拟 （一个在nodejs中可以模拟浏览器的library）<br>3.Enzyme:React组件渲染和测试 (在nodejs中渲染虚拟DOM进行测试，通过进行不同程度的render(shallow Rendering,Full Rendering,Static Rendering,进行不同程度的测试，比如利用shallow Rendering浅渲染测试渲染结果是否符合预期的DOM结构)<br>4.Nock: 模拟 HTTP请求 （模拟得到请求返回数据）<br>5.Sinon: 函数模拟和调用跟踪 （例如测试组件UI时，跟踪响应函数有没有被调用，调用几次，而不是去测试响应函数是否符合预期，测试响应函数是否符合预期属于响应函数测试范畴。集成在JEST中）<br>6.istanbul:单元测试覆盖率（通过对已有代码的修改和埋点去判断相关代码有没有被执行到）</p>
<h1 id="开发调试工具"><a href="#开发调试工具" class="headerlink" title="开发调试工具"></a>开发调试工具</h1><p>eslint<br>1.使用 .eslintrc 进行规则的配置<br>2.使用 airbnb 的 JavaScript 代码风格</p>
<p>检查语法风格，拼写错误，会报错，保证代码的一致性</p>
<p>Prettier<br>vscode 的一款插件，根据一定规则做代码格式化 .eslintrc<br>1.代码格式化的神器<br>2.保证更容易写出风格一致的代码<br>不会报错,会直接根据规则将代码格式化</p>
<p>React DevTool chrome插件<br>定位组件，可以以组件树的形式查看DOM结构，<br>勾选highlight updates可看到需要更新的组件</p>
<p>Redux DevTool chrome插件<br>可查看action和action引起的变化<br>time machine 功能，可以回溯action,方便观察loading过程，进而对loading进行优化<br>可自动生成测试代码</p>
<h1 id="理想架构"><a href="#理想架构" class="headerlink" title="理想架构"></a>理想架构</h1><p>易于开发（但可能会不容易扩展和维护）<br>1.开发工具是否完善 （采用的技术栈是否有相应的开发工具来支持）<br>2.生态圈是否繁荣 （是否有类似项目遇到过相同问题可以借鉴）<br>3.社区是否活跃（提问有人回答）</p>
<p>易于扩展<br>1.增加新功能是否容易<br>2.新功能是否会显著增加系统复杂度（系统放大之后会难以扩展和维护，考虑引进新功能时，如何架构能保证减少系统复杂度的提高）</p>
<p>易于维护<br>1.代码是否容易理解 （基于一定的最佳实践规范去编写，保证多人开发有一定的规则）<br>2.文档是否健全（通过注释，架构图，具体文档描述项目中的一些关键点，方便后续工作人员查看，也方便日后回头开发能快速理解关键点，来维护已有项目）</p>
<p>易于测试<br>1.功能的分层是否清晰 （UI，数据层之间依赖少）<br>2.副作用少 （模块高内聚，对外部依赖少）<br>3.尽量使用纯函数（输入决定输出，确定）</p>
<p>易于构建<br>1.使用通用技术和架构 （保证现有项目不需要定制化，就可以打包部署）<br>2.构建工具的选择（webpack ,roolup,使用常用技术栈，减少额外配置）</p>
<p>大型前端应用需要拆分复杂度原因<br>当项目增加更多功能的时候，项目复杂度并不会指数级的上升，始终保持在一个可控的范围之内</p>
<p>拆分复杂度技术架构</p>
<p>从功能上进行区分，将业务逻辑拆成高内聚松耦合的模块，每个模块负责一个功能，拥有自己的componet,action和reducer,这样即使当一个功能需要删除时，只要删除相应的模块即可，也保证其他模块不受影响；路由不再由一个文件统一定义，每个feature自己定义一个路由，然后由route的loader把每个模块的路由文件加载进根结点的routing文件</p>
<p>技术上的component,路由，reducer是按照功能的方式组织在模块上</p>
<p>如何组织 component,action 和reducer<br>文件夹结构<br>• 按 feature 组织源文件<br>• 组件和样式文件同一级<br>• React 单独文件夹<br>• 单元测试保持同样目录结构放在 tests 文件夹</p>
<p>组件和样式组织<br>一个功能的组件js和样式文件放在一个模块中，再由一个index.js引入各个模块的组件js文件，一个style文件引入各个模块的样式文件，进行统一管理输出,打包时就只是打包index.js和style文件<br>注意：<br>如果组件中引入样式文件，那么当这个组件被重复使用时，样式文件会被多次引入，打包时就会多次进行打包，造成不必要的代码冗余<br>使用上述加载方式，样式文件独立加载，js文件只需要加载它所需要的资源，就不会发生多次加载</p>
<p>action 和 reducer组织<br>一个模块的，action 和 reducer 一一对应放在同一文件，再由一个actions.js引入所有action,一个reducers.js引入所有reducer，这两个文件只是充当loader的角色<br>好处：action 和 reducer 非常小，不会被无限的去扩展，更容易理解</p>
<p>CONSTANTS.js中命名的常量一功能名开头，避免与其他模块常量命名冲突</p>
<p>再由rootreducer加载所有模块下的reducer,进行combineReducers挂载，实现全局使用</p>
<p>优点：一个模块内部是高内聚的，各个模块之间是松耦合的</p>
<p>主要思想：使用 root loader 加载 feature的各个资源</p>
<p>路由配置<br>每个模块（页面级）路由通过export JSON格式数据 ，自己配，再loader到根路由，由根路由统一处理解析json格式为react Router的声明式形式</p>
<p>每个模块都有都有自己的专属路由配置<br>顶层路由使用JSON配置更易维护和理解</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/react/course/thinking.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/react/course/thinking.html" itemprop="url">
                  开发思想
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-04T21:01:37+08:00">
                2018-12-04
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://codesandbox.io/s/6n20nrzlxz" target="_blank" rel="noopener">源码</a><br><a href="https://github.com/supnate/react-geek-time" target="_blank" rel="noopener">git仓库</a></p>
<h1 id="传统框架存在问题"><a href="#传统框架存在问题" class="headerlink" title="传统框架存在问题"></a>传统框架存在问题</h1><p>1.传统 UI操作关注太多细节<br>DOM API 繁多，需要手动调用，且要经过多步骤进行更新<br>react 解决办法：始终整体‘刷新’页面 ，无需关心细节，（不管谁是哪部分新增或更改的，根据现在状态整体刷新页面）</p>
<p>2.应用程序状态分散在各处f难以追踪和维护<br>传统数据模型存在问题：传统 MVC结构复杂，难以扩展和维护<br>react 解决办法：Flux 单向数据流</p>
<p>创建组件<br>1.创建静态 UI<br>2.考虑组件的状态组成 ：是由state内部维护还是用外部传进来的props维护<br>3.考虑组件的交互方式：内部进行了操作，如何告知/把状态暴露到父组件</p>
<h1 id="受控组件VS非受控组件"><a href="#受控组件VS非受控组件" class="headerlink" title="受控组件VS非受控组件"></a>受控组件VS非受控组件</h1><p>受控组件: 表单元素状态由使用者维护<br>组件发生变化，利用onchange将状态给到到父组件（使用者），父组件更新状态，再通过props传递状态给组件，组件重新渲染</p>
<p>非受控组件:表单元素状态 DOM自身维护</p>
<h1 id="创建原则：单一职责原则"><a href="#创建原则：单一职责原则" class="headerlink" title="创建原则：单一职责原则"></a>创建原则：单一职责原则</h1><p>1.每个组件只做一件事<br>2.如果组件变得复杂，那么应该拆分成小组件<br>   拆分成小组件好处：<br>   a.降低复杂度；<br>   b.提高性能，如果一个组件足够大之后，任何一种状态变化，都会引起整个组件刷新，<br>拆分成小组件后，未涉及到的小组件，没有状态变化，就不会刷新</p>
<h1 id="数据状态管理：DRY（Don’t-Repeat-Yourself）原则"><a href="#数据状态管理：DRY（Don’t-Repeat-Yourself）原则" class="headerlink" title="数据状态管理：DRY（Don’t Repeat Yourself）原则"></a>数据状态管理：DRY（Don’t Repeat Yourself）原则</h1><p>1.能计算得到的状态就不要单独存储 :<br>2.组件尽量无状态，所需数据通过 props 获取</p>
<h1 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h1><p>本质：不是模板语言，而是一种语法糖(相当于使用React.createElement创建组件)<br>优点：<br>1.声明式创建界面的直观（可以使用自定义和原生标签直接进行创建，方便构建UI）<br>2.代码动态创建界面的灵活 （节点的创建，属性更改，消失完全可以向写JS一样进行操作）<br>3.无需学习新的模板语言（JS+JSX特性）<br>约定：自定义组件以大写字母开头<br>1.react 认为小写的 tag是原生 dom 节点,如 div<br>2.大写字母开头为自定义组件<br>3.JSX 标记可以直接使用属性语法，例如&lt;meau.Item /&gt;，使用属性语法，可以不以大写字母开头<br>JSX防注入攻击<br>React DOM 在渲染之前默认会 过滤 所有传入的值。它可以确保你的应用不会被注入攻击。<br>所有的内容在渲染之前都被转换成了字符串。这样可以有效地防止 XSS(跨站脚本) 攻击</p>
<h1 id="生命周期方法"><a href="#生命周期方法" class="headerlink" title="生命周期方法"></a>生命周期方法</h1><p>constructor<br>js标准类的构造函数<br>1.用于初始化内部状态，很少使用（初始化工作一般会在其他声明周期内使用）<br>2.唯一可以直接修改state的地方(可以这么写this.state.xxx = ‘abc’)</p>
<p>getDerivedStateFromProps<br>react 16.3新引入的API<br>从属性props初始化内部状态state<br>1.当 state 需要从 props 初始化时使用<br>2.尽量不要使用：维护两者状态一致性会增加复杂度<br>    如果state需要从props获得，一般使用props可以通过动态计算得到，如果用state进行单独存储，就有必要时刻维护二者的一致性<br>    维护一致性则增加了复杂度，容易出BUG<br>3.每次 render都会调用<br>    该方代替原来的componentwillreceiveProps方法<br>4.典型场景:表单控件获取默认值<br>    初始值来自props,用户输入后为用户输入的值</p>
<p>componentDidMount<br>1.UI渲染完成后调用<br>2.只执行一次<br>3.典型场景:获取外部资源（只需要获取一次资源）</p>
<p>componentWillUnmount<br>1.组件移除时被调用<br>2.典型场景：资源释放</p>
<p>getSnapshotBeforeUpdate<br>1.在页面 render之前调用，state 已更新<br>2.典型场景：获取 render之前的 DOM 状态</p>
<p>componentDidUpdate<br>捕获每一次更新<br>1.每次 UI 更新时被调用<br>2.典型场景:页面需要根据 props 变化重新获取数据</p>
<p>shouldComponentUpdate<br>1.组件决定 Virtual DOM是否要重绘<br>2.一般可以由 PureComponent 自动实现<br>3.典型场景:细节性能优化</p>
<p>在react 16.3中去掉的方法有<br>componentWillMount<br>componentWillReceive<br>componentWillUpdate</p>
<p>状态更新可能是异步的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//此代码可能无法更新计数器</span><br><span class="line">this.setState(&#123;</span><br><span class="line">  counter: this.state.counter + this.props.increment,</span><br><span class="line">&#125;);</span><br><span class="line">//更改为以下写法即可</span><br><span class="line">this.setState((prevState, props) =&gt; (&#123;</span><br><span class="line">  counter: prevState.counter + props.increment</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></p>
<p>1.算法复杂度O(n):通过广度优先分层比较/遍历实现线性算法</p>
<p>2.虚拟 DOM如何计算 diff<br>虚拟 DOM的两个假设<br>a.组件的 DOM结构是相对稳定的<br>b.类型相同的兄弟节点可以被唯一标识<br>根结点比较<br>属性变化及顺序：利用标识调整位置<br>节点类型发生变化：删除原有结点，构建新类型结点<br>节点跨层移动：删除原有结点，在应有（新）位置构建相同类型新结点</p>
<p>3.key属性的作用：提高性能</p>
<h1 id="组件复用设计模式"><a href="#组件复用设计模式" class="headerlink" title="组件复用设计模式"></a>组件复用设计模式</h1><p>1.高阶组件</p>
<p>传入原始组件，结合生命周期创建一些额外的功能，然后附加到原始组件上，返回增加功能后的原始组件<br>额外的功能一般都是一些通用的功能，避免在原始组建上增加额外功能<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">export default function withTimer(WrappedComponent) &#123;</span><br><span class="line">  return class extends React.Component &#123;</span><br><span class="line">    state = &#123; time: new Date() &#125;;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">      this.timerID = setInterval(() =&gt; this.tick(), 1000);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">      clearInterval(this.timerID);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tick() &#123;</span><br><span class="line">      this.setState(&#123;</span><br><span class="line">        time: new Date()</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;WrappedComponent time=&#123;this.state.time&#125; &#123;...this.props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.函数子组件</p>
<p>将子组件以函数返回值形式作为children属性传入原始组件，在原始组件中，在需要显示原始组件的地方执行函数，<br>或者在合适的生命周期中执行函数拿到多个子组件，再决定在什么位置显示不同的子组件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//写法一</span><br><span class="line">&lt;Mouse children=&#123;mouse =&gt; (</span><br><span class="line">  &lt;p&gt;The mouse position is &#123;mouse.x&#125;, &#123;mouse.y&#125;&lt;/p&gt;</span><br><span class="line">)&#125;/&gt;</span><br><span class="line">//写法二</span><br><span class="line">&lt;Mouse&gt;</span><br><span class="line">  &#123;mouse =&gt; (</span><br><span class="line">    &lt;p&gt;The mouse position is &#123;mouse.x&#125;, &#123;mouse.y&#125;&lt;/p&gt;</span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/Mouse&gt;</span><br><span class="line"></span><br><span class="line">//在原始组件应用子组件</span><br><span class="line">class Mouse extends React.Component&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &#123;this.props.children(&#123;x:50,y:100&#125;)&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="context-API"><a href="#context-API" class="headerlink" title="context API"></a>context API</h1><p>应用场景：全局性的一些字段，如theme的切换<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const enStrings = &#123;</span><br><span class="line">  submit: &quot;Submit&quot;,</span><br><span class="line">  cancel: &quot;Cancel&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const cnStrings = &#123;</span><br><span class="line">  submit: &quot;提交&quot;,</span><br><span class="line">  cancel: &quot;取消&quot;</span><br><span class="line">&#125;;</span><br><span class="line">//传入原始数据/默认值，创建context</span><br><span class="line">const LocaleContext = React.createContext(enStrings);</span><br><span class="line"></span><br><span class="line">class LocaleProvider extends React.Component &#123;</span><br><span class="line">  state = &#123; locale: cnStrings &#125;;</span><br><span class="line">  toggleLocale = () =&gt; &#123;</span><br><span class="line">    const locale =</span><br><span class="line">      this.state.locale === enStrings</span><br><span class="line">        ? cnStrings</span><br><span class="line">        : enStrings;</span><br><span class="line">    this.setState(&#123; locale &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      // context的 Provider属性是一个组件，包裹需要用到context数据子组件的组件，其value值为相应在子组件中需要用到的数据</span><br><span class="line">      &lt;LocaleContext.Provider value=&#123;this.state.locale&#125;&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.toggleLocale&#125;&gt;</span><br><span class="line">          切换语言</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      &lt;/LocaleContext.Provider&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class LocaledButtons extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">    //context的 Consumer属性也是一个组件，包裹需要使用context数据的子组件,</span><br><span class="line">      &lt;LocaleContext.Consumer&gt;</span><br><span class="line">        &#123;locale =&gt; (//local 即Context.Provider 的value值</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;button&gt;&#123;locale.cancel&#125;&lt;/button&gt;</span><br><span class="line">            &amp;nbsp;&lt;button&gt;&#123;locale.submit&#125;&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      &lt;/LocaleContext.Consumer&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;LocaleProvider&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;LocaledButtons /&gt;//使用context数据的组件必须为Provider组件的子组件，</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/LocaleProvider&gt;</span><br><span class="line">    &lt;LocaledButtons /&gt;//如果子组件在Context.Provider形成组件的外面使用，则只会应用默认数据，不会随Value属性发生变化</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h1 id="为什么需要脚手架"><a href="#为什么需要脚手架" class="headerlink" title="为什么需要脚手架"></a>为什么需要脚手架</h1><p>react:进行UI开发<br>redux:进行状态的管理<br>react/router:进行路由的管理<br>babel:把最新的js特性翻译成兼容浏览器的旧的JS语法<br>webpack:进行打包<br>eslint:语法检查<br>因而需要引入以上几个技术栈的几十个个package,不但要了解，还要知道如何让进行相应的配置<br>在开启一个项目时，配置过程做完一次基本/只要实现一次，就基本可以复用，用来再开启新项目<br>所以为方便开发，用脚手架实现配置过程</p>
<p>脚手架有：<br>Create React App 基础（webpack,）<br>Rekit 开源项目<br>Codesandbox 在线开发工具<br>dva 蚂蚁金服的一套脚手架工具</p>
<h1 id="为什么需要打包"><a href="#为什么需要打包" class="headerlink" title="为什么需要打包"></a>为什么需要打包</h1><p>1.编译ES6语法特性，编译JSX（保证浏览器可以兼容执行）<br>2.整合资源，例如图片，Less/Sass，svg<br>3.优化代码体积(对变量名进行缩短，去除注释，去除空格，去除不必要的变量等等)</p>
<p>webpack<br>将项目中所有资源进行整合，将每种资源（js，png，sass…）使用插件的方式载入对应的Loader,<br>loader能够决定自己支持什么样的语法，loader的输出是可以执行的js语言，可以兼容多平台多版本浏览器<br>可以部署的语言</p>
<p>打包注意事项<br>1.设置nodejs环境为production<br>开发环境可能需要检查输入的参数的类型，语法，拼写等问题，但生产环境不需要</p>
<p>2.禁用开发时专用代码，比如logger<br>打包时可以根据环境判断决定是否执行一定的代码，所以开发用到的代码在打包时不应被打到生产环境，要做区分<br>3.设置应用根路径<br>告诉应用到哪里获取地址</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/designMode/command.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/designMode/command.html" itemprop="url">
                  命令模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-08T21:09:09+08:00">
                2018-11-08
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="应用情景"><a href="#应用情景" class="headerlink" title="应用情景"></a>应用情景</h1><p>有时候需要向某些对象发送请求，但是并不知道请求的接收者是谁，也不知道被请求的操作是什么。<br>此时希望用一种松耦合的方式设计软件，使得请求发送者和请求接收者能够消除彼此之间的耦合关系</p>
<h1 id="主要思想"><a href="#主要思想" class="headerlink" title="主要思想"></a>主要思想</h1><p>将命令接收者的具体执行函数存入 命令堆栈，命令发起者需要执行/撤销动作时，对堆栈进行处理<br>命令接收者可以以闭包形式被执行，也可以作为对象属性被执行到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">//闭包形式</span><br><span class="line">var setCommand = function(btn,fn)&#123;</span><br><span class="line">	btn.onclick = function()&#123;</span><br><span class="line">		fn()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">var MenuBar = &#123;</span><br><span class="line">	refresh:function()&#123;</span><br><span class="line">		console.log(&apos;refresh menu&apos;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">var RefreshMenuBarCommand = function(reciver)&#123;</span><br><span class="line">	return function()&#123;reciver.refresh()&#125;</span><br><span class="line">&#125;</span><br><span class="line">var refreshMenuBarCommand = RefreshMenuBarCommand(Menubar)</span><br><span class="line">setCommand(btn1,refreshMenuBarCommand)</span><br><span class="line"></span><br><span class="line">//宏命令，组装一个可以一次性触发多个命令的命令；属性形式，统一使用execute触发</span><br><span class="line">var MacroCommand = function()&#123;</span><br><span class="line">	return &#123;</span><br><span class="line">		commandsList:[],</span><br><span class="line">		add:function(command)&#123;</span><br><span class="line">			this.commandsList.push(command);</span><br><span class="line">		&#125;,</span><br><span class="line">		execute:function()&#123;</span><br><span class="line">			for(var i=0,cammand;command = this.commandsList[i++];)&#123;</span><br><span class="line">				command.execute();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		undo:function()&#123;</span><br><span class="line">			for(var i=0,cammand;command = this.commandsList[i++];)&#123;</span><br><span class="line">				command.undo();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">var closeDoorCom =&#123;</span><br><span class="line">	execute:function()&#123;</span><br><span class="line">		console.log(&apos;close door&apos;)</span><br><span class="line">	&#125;,</span><br><span class="line">	undo:function()&#123;console.log(&apos;open door&apos;)&#125;</span><br><span class="line">&#125;</span><br><span class="line">var openTvCom =&#123;</span><br><span class="line">	execute:function()&#123;</span><br><span class="line">		console.log(&apos;open TV&apos;)</span><br><span class="line">	&#125;,</span><br><span class="line">	undo:function()&#123;console.log(&apos;close Tv&apos;)&#125;</span><br><span class="line">&#125;</span><br><span class="line">var macroCommand = MacroCommand()</span><br><span class="line">macroCommand.add(closeDoorCom)</span><br><span class="line">macroCommand.add(openTvCom)</span><br><span class="line">macroCommand.execute()</span><br><span class="line">macroCommand.undo()</span><br></pre></td></tr></table></figure>
<h1 id="与策略区别"><a href="#与策略区别" class="headerlink" title="与策略区别"></a>与策略区别</h1><p>策略模式指向问题域更小，所有策略对象目标一致，他们只是达到这个目的的不同手段，内部实现针对‘算法’<br>命令对象解决的目标更具发散性，还可以完成撤销，排队等功能</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/designMode/event.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/designMode/event.html" itemprop="url">
                  订阅发布模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-08T20:57:09+08:00">
                2018-11-08
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="主要思想"><a href="#主要思想" class="headerlink" title="主要思想"></a>主要思想</h1><p>通过逻辑处理函数/对象event，使事件订阅和发布过程忽略事件的具体处理过程<br>订阅时只需要给到event要订阅的事件A，和响应函数，<br>发布时给到event事件A被触发和相关参数，即可执行订阅时的响应函数<br>event 充当中介者的角色，管理事件响应的存储和执行</p>
<p>1.简单实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">let event = &#123;</span><br><span class="line">	caches:&#123;&#125;,</span><br><span class="line">	on:function(name,fn)&#123;</span><br><span class="line">		if(!this.caches[name])&#123;</span><br><span class="line">			this.caches[name] = []</span><br><span class="line">		&#125;</span><br><span class="line">		this.caches[name].push(fn)</span><br><span class="line">	&#125;,</span><br><span class="line">	emit:function(name,...args)&#123;</span><br><span class="line">		if(!this.caches[name])&#123;return&#125;</span><br><span class="line">		for(let i=0;i&lt;this.caches[name].length;i++)&#123;</span><br><span class="line">			let fn=this.caches[name][i]</span><br><span class="line">			fn(args)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	remove:function(name,fn)&#123;</span><br><span class="line">		if(this.caches[name].length&lt;1)&#123;return&#125;</span><br><span class="line">		for(let i=0;i&lt;this.caches[name].length;i++)&#123;</span><br><span class="line">			let fn1=this.caches[name][i]</span><br><span class="line">			if(fn === fn1)&#123;</span><br><span class="line">				this.caches[name].splice(i,1)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">let fn1 = (val)=&gt;&#123;console.log(val,1)&#125;</span><br><span class="line">let fn2 = (val)=&gt;&#123;console.log(val,2)&#125;</span><br><span class="line">event.on(&apos;aaa&apos;,fn1)</span><br><span class="line">event.on(&apos;aaa&apos;,fn2)</span><br><span class="line">event.emit(&apos;aaa&apos;,&apos;fire!&apos;)</span><br></pre></td></tr></table></figure></p>
<p>2.全局事件冲突<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">var Event = (function()&#123; </span><br><span class="line">    var global = this,</span><br><span class="line">        Event,_default = &apos;default&apos;; </span><br><span class="line">    Event = function()&#123;         </span><br><span class="line">        var _listen, </span><br><span class="line">        _trigger,</span><br><span class="line">        _remove,</span><br><span class="line">        _slice = Array.prototype.slice,</span><br><span class="line">        _shift = Array.prototype.shift,</span><br><span class="line">        _unshift = Array.prototype.unshift,              </span><br><span class="line">        namespaceCache = &#123;&#125;,              </span><br><span class="line">        _create,              </span><br><span class="line">        find,             </span><br><span class="line">        each = function( ary, fn )&#123;                 </span><br><span class="line">            var ret;                 </span><br><span class="line">            for ( var i = 0, l = ary.length; i &lt; l; i++ )&#123;</span><br><span class="line">                var n = ary[i];                     </span><br><span class="line">                ret = fn.call( n, i, n);                 </span><br><span class="line">            &#125;                 </span><br><span class="line">            return ret;             </span><br><span class="line">            &#125;; </span><br><span class="line"></span><br><span class="line">           _listen = function( key, fn, cache )&#123;                </span><br><span class="line">               if ( !cache[ key ] )&#123;                    </span><br><span class="line">                   cache[ key ] = [];                </span><br><span class="line">                &#125;               </span><br><span class="line">                cache[key].push( fn );            </span><br><span class="line">            &#125;; </span><br><span class="line"></span><br><span class="line">           _remove = function( key, cache ,fn)&#123;                </span><br><span class="line">               if ( cache[ key ] )&#123;                    </span><br><span class="line">                   if( fn )&#123;                        </span><br><span class="line">                       for( var i = cache[ key ].length; i &gt;= 0; i-- )&#123;                            </span><br><span class="line">                           if( cache[ key ][i] === fn )&#123;                                </span><br><span class="line">                               cache[ key ].splice( i, 1 );                            </span><br><span class="line">                            &#125;                        </span><br><span class="line">                        &#125;                    </span><br><span class="line">                    &#125;else&#123;                        </span><br><span class="line">                        cache[ key ] = [];                    </span><br><span class="line">                    &#125;                </span><br><span class="line">                &#125;            </span><br><span class="line">            &#125;; </span><br><span class="line"> </span><br><span class="line">           _trigger = function()&#123;                </span><br><span class="line">               var cache = _shift.call(arguments),                      </span><br><span class="line">               key = _shift.call(arguments),                      </span><br><span class="line">               args = arguments,                      </span><br><span class="line">               _self = this,                     </span><br><span class="line">              ret,                      </span><br><span class="line">              stack = cache[ key ]; </span><br><span class="line"> </span><br><span class="line">              if ( !stack || !stack.length )&#123;                    </span><br><span class="line">                   return;                </span><br><span class="line">              &#125; </span><br><span class="line"> </span><br><span class="line">               return each( stack, function()&#123;                    </span><br><span class="line">                   return this.apply( _self, args );                </span><br><span class="line">                &#125;);             </span><br><span class="line">            &#125;; </span><br><span class="line"> </span><br><span class="line">            _create = function( namespace )&#123;                 </span><br><span class="line">                var namespace = namespace || _default;                 </span><br><span class="line">                var cache = &#123;&#125;,                     </span><br><span class="line">                offlineStack = [],    // 离线事件                      </span><br><span class="line">                ret = &#123;                         </span><br><span class="line">                    listen: function( key, fn, last )&#123;                             </span><br><span class="line">                        _listen( key, fn, cache );                             </span><br><span class="line">                        if ( offlineStack === null )&#123;                                 </span><br><span class="line">                            return;                             </span><br><span class="line">                        &#125;                             </span><br><span class="line">                        if ( last === &apos;last&apos; )&#123;                        </span><br><span class="line">                            offlineStack.length &amp;&amp; offlineStack.pop()();                             </span><br><span class="line">                        &#125;else&#123;                                 </span><br><span class="line">                            each( offlineStack, function()&#123;                                 </span><br><span class="line">                                this();                             </span><br><span class="line">                                &#125;);                          </span><br><span class="line">                        &#125; </span><br><span class="line"> </span><br><span class="line">                         offlineStack = null;                      </span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    one: function( key, fn, last )&#123;                          </span><br><span class="line">                        _remove( key, cache );                          </span><br><span class="line">                        this.listen( key, fn ,last );                      </span><br><span class="line">                    &#125;,                      </span><br><span class="line">                        </span><br><span class="line">                    remove: function( key, fn )&#123;                          </span><br><span class="line">                        _remove( key, cache ,fn);                      </span><br><span class="line">                    &#125;,                      </span><br><span class="line">                    trigger: function()&#123;                          </span><br><span class="line">                        var fn,                              </span><br><span class="line">                        args,                              </span><br><span class="line">                        _self = this; </span><br><span class="line"> </span><br><span class="line">                        _unshift.call( arguments, cache );                          </span><br><span class="line">                        args = arguments;                          </span><br><span class="line">                        fn = function()&#123;                              </span><br><span class="line">                            return _trigger.apply( _self, args );                          </span><br><span class="line">                        &#125;; </span><br><span class="line"> </span><br><span class="line">                        if ( offlineStack )&#123;                              </span><br><span class="line">                            return offlineStack.push( fn );                          </span><br><span class="line">                        &#125;                        </span><br><span class="line">                        return fn();                       </span><br><span class="line">                    &#125;                    </span><br><span class="line">                &#125;; </span><br><span class="line">                return namespace ?( namespaceCache[ namespace ] ? namespaceCache[ namespace ] :            namespaceCache[ namespace ] = ret ): ret;                </span><br><span class="line">            &#125;; </span><br><span class="line"> </span><br><span class="line">        return &#123;                 </span><br><span class="line">            create: _create,                 </span><br><span class="line">            one: function( key,fn, last )&#123;                     </span><br><span class="line">                var event = this.create( );                         </span><br><span class="line">                event.one( key,fn,last );                 </span><br><span class="line">                &#125;,                 </span><br><span class="line">            remove: function( key,fn )&#123;                  </span><br><span class="line">                var event = this.create( );                     </span><br><span class="line">                event.remove( key,fn );                 </span><br><span class="line">                &#125;,                 </span><br><span class="line">            listen: function( key, fn, last )&#123;                     </span><br><span class="line">                var event = this.create( );                         </span><br><span class="line">                event.listen( key, fn, last );                     </span><br><span class="line">                &#125;,                 </span><br><span class="line">            trigger: function()&#123; </span><br><span class="line">                var event = this.create( );                     </span><br><span class="line">                event.trigger.apply( this, arguments );                  </span><br><span class="line">                &#125;           </span><br><span class="line">            &#125;;     </span><br><span class="line">    &#125;(); </span><br><span class="line"></span><br><span class="line">    return Event; </span><br><span class="line"> </span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/designMode/AOP.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/designMode/AOP.html" itemprop="url">
                  AOP(切面)编程/装饰者模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-07T21:57:09+08:00">
                2018-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>在不改变对象自身的基础上，在程序运行期间给对象动态的添加职责</p>
<h1 id="主要思想"><a href="#主要思想" class="headerlink" title="主要思想"></a>主要思想</h1><p>在每次要执行具体函数B时，先执行A，在每次执行完B之后都执行C，<br>以此类推，有必要的话，在C执行完再执行D，从而形成执行链</p>
<h1 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h1><p>先用一个temp函数包住AB,再用一个final函数包住temp和C，这样，在执行final函数时，会按顺序A-B-C执行</p>
<p>1.使用普通函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">let before=(fn,beforeFn)=&gt;&#123;</span><br><span class="line">	return (...args)=&gt;&#123;</span><br><span class="line">		beforeFn(args)</span><br><span class="line">		return fn(args)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">let after = (fn,afterFn)=&gt;&#123;</span><br><span class="line">	return (...args)=&gt;&#123;</span><br><span class="line">		let ret = fn(args)</span><br><span class="line">		afterFn(args)</span><br><span class="line">		return ret</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let a = ()=&gt;&#123;console.log(2)&#125;</span><br><span class="line">a = before(a,()=&gt;&#123;console.log(1)&#125;)</span><br><span class="line">a = after(a,()=&gt;&#123;console.log(3)&#125;)</span><br><span class="line">a() //1,2,3</span><br></pre></td></tr></table></figure></p>
<p>2.改造Function对象,可以实现链式添加职责</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.before = function(beforeFn)&#123;</span><br><span class="line">	return ()=&gt;&#123;</span><br><span class="line">		beforeFn(arguments);</span><br><span class="line">		return this(arguments);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Function.prototype.after = function(afterFn)&#123;</span><br><span class="line">	return ()=&gt;&#123;</span><br><span class="line">		let ret = this(arguments);</span><br><span class="line">		afterFn(arguments);</span><br><span class="line">		return ret;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">var func = function ()&#123;</span><br><span class="line">console.log(2); </span><br><span class="line">return 15&#125;</span><br><span class="line">func = func.before(()=&gt;&#123;console.log(1)&#125;).after(()=&gt;&#123;console.log(3)&#125;)</span><br><span class="line">func() //1,2,3 返回15</span><br></pre></td></tr></table></figure>
<h1 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h1><p>1.数据统计上报<br>  将点击响应事件包含的上报动作隔离出来，以after的顺序，装饰到点击事件响应函数上</p>
<p>2.动态改变函数参数<br>  组装ajax请求参数时，在请求函数前装饰before函数，进行不同参数参加处理</p>
<p>3.插件式表单验证<br>  在submit函数前装饰before函数进行不同条件验证</p>
<h1 id="区分代理模式"><a href="#区分代理模式" class="headerlink" title="区分代理模式"></a>区分代理模式</h1><p>代理模式的意图是当直接访问本体不方便或者不符合需要时，为这个本体提供一个替代者，<br>本体定义了关键功能，而代理提供或拒绝对它的访问，或者在访问本体之前做一些额外的事情<br>通常只有一层代理-本体的引用</p>
<p>AOP的作用用于对对象加入行为，一开始不能确定对象的全部功能时，<br>经常会形成一条装饰链</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/designMode/iterator.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/designMode/iterator.html" itemprop="url">
                  迭代器模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-06T22:23:09+08:00">
                2018-11-06
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>提供一种方法顺序访问一个聚合对象种的各个元素，而又不需要暴露该对象的内部表示<br>把迭代过程从业务逻辑中分离出来，不用关心对象的内部构造，可以按顺序访问其中的每个元素</p>
<h1 id="用途-场景"><a href="#用途-场景" class="headerlink" title="用途/场景"></a>用途/场景</h1><p>查找可用组件，进行数据处理</p>
<h1 id="主要思想"><a href="#主要思想" class="headerlink" title="主要思想"></a>主要思想</h1><p>内部迭代器<br>函数内部定义好迭代规则，完全接手整个迭代过程，外部只需要一次初始调用</p>
<p>外部迭代器<br>需要调用进行下一轮迭代的函数，可以手工控制迭代的过程或者顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">//使用内部迭代器实现</span><br><span class="line">var iteratorInner=(arr,fn)=&gt;&#123;</span><br><span class="line">	for(let i=0;i&lt;arr.length;i++)&#123;</span><br><span class="line">		fn(arr,i)</span><br><span class="line">	&#125;</span><br><span class="line">	return arr</span><br><span class="line">&#125;</span><br><span class="line">console.log(iteratorInner([1,2,3],(arr,i)=&gt;&#123;arr[i]++&#125;)) //[2,3,4] </span><br><span class="line"></span><br><span class="line">//使用外部迭代器</span><br><span class="line">let iteratorOuter = (arr,fn)=&gt;&#123;</span><br><span class="line">	let count = 0;</span><br><span class="line">    let nextFn =()=&gt;&#123;</span><br><span class="line">		if(count &lt;arr.length)&#123;</span><br><span class="line">			fn(arr,count)</span><br><span class="line">		&#125;</span><br><span class="line">		return &#123;</span><br><span class="line">			result:arr,</span><br><span class="line">			count:count === arr.length ? count:++count,,</span><br><span class="line">			done:count === arr.length</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return &#123;</span><br><span class="line">		next:nextFn,</span><br><span class="line">		isdone:count === arr.length</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">var it = iteratorOuter([1,2,3],(arr,i)=&gt;&#123;</span><br><span class="line">	arr[i]++</span><br><span class="line">&#125;)</span><br><span class="line">console.log(it.next())</span><br><span class="line">//count: 1</span><br><span class="line">//done: false</span><br><span class="line">//result: (3) [2, 3, 4]</span><br><span class="line">console.log(it.next())</span><br><span class="line">//count: 2</span><br><span class="line">//done: false</span><br><span class="line">//result: (3) [2, 3, 4]</span><br><span class="line">console.log(it.next())</span><br><span class="line">//count: 3</span><br><span class="line">//done: true</span><br><span class="line">//result: (3) [2, 3, 4]</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/designMode/adapter.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/designMode/adapter.html" itemprop="url">
                  适配器模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-06T22:11:09+08:00">
                2018-11-06
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>定义<br>解决俩个软件实体间接口不兼容的问题，使用适配器模式之后，原本由于接口不兼容而不能工作的两个软件实体，可以一起工作</p>
<p>用途/场景<br>1.调用第三方（地图/支付）接口时，不同平台提供的相同功能的接口函数名不同，或者调用时需要进行的操作过程不同，<br>  将这些过程封装/分类，通过适配器决定如何使用</p>
<p>2.处理数据,将不符合使用要求的数据结构转换成预期的样子</p>
<p>主要思想<br>将处理过程封装在适配器函数中,直接在适配器函数中进行处理，或者让适配器返回处理后的可适用结果<br>调用适配器传入需要处理的数据/条件，适配器进行处理或返回处理结果</p>
<p>注意事项<br>那些繁琐的处理代码始终是存在的，只不过在写业务的时候看不到它罢了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">1.转换数据结构</span><br><span class="line">//将如下数据结构</span><br><span class="line">var guangdongCity = [&#123;             </span><br><span class="line">        name: &apos;shenzhen&apos;,             </span><br><span class="line">        id: 11,         </span><br><span class="line">    &#125;, &#123;             </span><br><span class="line">        name: &apos;guangzhou&apos;,             </span><br><span class="line">        id: 12,         </span><br><span class="line">    &#125;];</span><br><span class="line">//转换成如下数据结构</span><br><span class="line">var guangdongCity = &#123;     shenzhen: 11,      guangzhou: 12&#125;;</span><br><span class="line"></span><br><span class="line">var adapter = (data)=&gt;&#123;</span><br><span class="line">	let temp = &#123;&#125;;</span><br><span class="line">	for(let i=0;i&lt;data.length;i++)&#123;</span><br><span class="line">		temp[data[i].name] = data[i].id</span><br><span class="line">	&#125;</span><br><span class="line">	return temp</span><br><span class="line">&#125;</span><br><span class="line">console.log(adapter(guangdongCity))</span><br><span class="line"></span><br><span class="line">2.SDK适配例子1</span><br><span class="line">var googleMap = &#123;      </span><br><span class="line">    show: function()&#123;          </span><br><span class="line">        console.log( &apos;开始渲染谷歌地图&apos; );      </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;; </span><br><span class="line">var baiduMap = &#123;       </span><br><span class="line">        display: function()&#123;          </span><br><span class="line">            console.log( &apos;开始渲染百度地图&apos; );      </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;; </span><br><span class="line">var baiduMapAdapter = &#123;      </span><br><span class="line">        show: function()&#123;          </span><br><span class="line">            return baiduMap.display();    </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;;</span><br><span class="line">var renderMap = function( map )&#123;     </span><br><span class="line">    if ( map.show instanceof Function )&#123;         </span><br><span class="line">        map.show();     </span><br><span class="line">    &#125; </span><br><span class="line">&#125;; </span><br><span class="line">renderMap( googleMap );        // 输出：开始渲染谷歌地图 </span><br><span class="line">renderMap( baiduMapAdapter );    // 输出：开始渲染百度地图 </span><br><span class="line">3.SDK适配例子2</span><br><span class="line">function pay (&#123;</span><br><span class="line">  price,</span><br><span class="line">  goodsId</span><br><span class="line">&#125;) &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    const config = &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    switch (platform) &#123;</span><br><span class="line">      case &apos;wechat&apos;:</span><br><span class="line">        // 微信的处理逻辑</span><br><span class="line">        config.price = price</span><br><span class="line">        config.goodsId = goodsId</span><br><span class="line">        config.appId = &apos;XXX&apos;</span><br><span class="line">        config.secretKey = &apos;XXX&apos;</span><br><span class="line">        wx.pay(config).then((err, data) =&gt; &#123;</span><br><span class="line">          if (err) return reject(err)</span><br><span class="line"> </span><br><span class="line">          resolve(data)</span><br><span class="line">        &#125;)</span><br><span class="line">      break</span><br><span class="line">      case &apos;QQ&apos;:</span><br><span class="line">        // QQ的处理逻辑</span><br><span class="line">        config.price = price * 100</span><br><span class="line">        config.gid = goodsId</span><br><span class="line">        config.appId = &apos;XXX&apos;</span><br><span class="line">        config.secretKey = &apos;XXX&apos;</span><br><span class="line">        config.success = resolve</span><br><span class="line">        config.error = reject</span><br><span class="line">        qq.pay(config)</span><br><span class="line">      break</span><br><span class="line">      case &apos;alipay&apos;:</span><br><span class="line">        // 支付宝的处理逻辑</span><br><span class="line">        config.payment = price</span><br><span class="line">        config.id = goodsId</span><br><span class="line">        config.token = &apos;XXX&apos;</span><br><span class="line">        alipay.pay(config, resolve, reject)</span><br><span class="line">      break</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">// run anywhere</span><br><span class="line">await pay(&#123;</span><br><span class="line">  price: 10,</span><br><span class="line">  goodsId: 1</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>对于SDK提供方，仅仅需要知道自己所需要的一些参数，然后按照自己的方式进行数据返回。</p>
<p>对于SDK调用方，仅仅需要我们约定好的通用的参数，以及按照约定的方式进行监听回调处理。</p>
<p>整合多个第三方SDK的任务交由适配器来做，然后将适配器的代码压缩，混淆，放在一个看不见的角落里去，这样的代码逻辑就会变得很清晰了<br>参考资料:<a href="https://mp.weixin.qq.com/s/QRqeDCzD0APyj2g7BNqtpg" target="_blank" rel="noopener">适配器在JavaScript中的体现</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/designMode/proxy.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/designMode/proxy.html" itemprop="url">
                  代理模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-06T22:10:09+08:00">
                2018-11-06
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h1><p>保护代理<br>代理B可以帮助A过滤掉一些请求，可以直接在代理B中拒绝掉<br>用于控制不同权限的对象对目标对象的访问</p>
<p>虚拟代理<br>把一些开销很大的对象，延迟到真正需要它的时候才去创建</p>
<h1 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h1><p>就一个类（通常也包括对象和函数）而言，应该仅有一个引起它变化的原因。</p>
<h1 id="主要思想"><a href="#主要思想" class="headerlink" title="主要思想"></a>主要思想</h1><p>A想调用C，要经过B，B在中间做C的代理，用于判断什么时候可以执行C<br>比如多次调用缓存起来再一起执行C；传入相同参数只计算一次，将结果保存，以后传入相同参数直接返回结果，不再计算</p>
<h1 id="用途-实现"><a href="#用途-实现" class="headerlink" title="用途/实现"></a>用途/实现</h1><p>1.虚拟代理合并 HTTP请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//可以通过一个代理函数 proxySynchronousFile 来收集一段时间之内的请求， 后一次性发送给服务器。</span><br><span class="line">var synchronousFile = function( id )&#123;     </span><br><span class="line">    console.log( &apos;开始同步文件，id 为: &apos; + id ); </span><br><span class="line">&#125;; </span><br><span class="line"> </span><br><span class="line">var proxySynchronousFile = (function()&#123;     </span><br><span class="line">    var cache = [],    // 保存一段时间内需要同步的 ID         </span><br><span class="line">    timer;    // 定时器 </span><br><span class="line">    return function( id )&#123;         </span><br><span class="line">        cache.push( id );  //每次进来收集       </span><br><span class="line">        if ( timer )&#123;    </span><br><span class="line">            // 保证不会覆盖已经启动的定时器             </span><br><span class="line">            return;         </span><br><span class="line">        &#125; </span><br><span class="line">        timer = setTimeout(function()&#123;             </span><br><span class="line">            synchronousFile( cache.join( &apos;,&apos; ) );    // 2 秒后向本体发送需要同步的 ID 集合 到时间统一处理           clearTimeout( timer );    // 清空定时器             </span><br><span class="line">            timer = null;             </span><br><span class="line">            cache.length = 0; // 清空 ID 集合         </span><br><span class="line">            &#125;, 2000 );     </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;)(); </span><br><span class="line">var checkbox = document.getElementsByTagName( &apos;input&apos; ); </span><br><span class="line">for ( var i = 0, c; c = checkbox[ i++ ]; )&#123; </span><br><span class="line">     c.onclick = function()&#123;         </span><br><span class="line">        if ( this.checked === true )&#123;             </span><br><span class="line">            proxySynchronousFile( this.id );         </span><br><span class="line">        &#125;     </span><br><span class="line">    &#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>2.缓存代理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">var mult = function()&#123;     </span><br><span class="line">    console.log( &apos;开始计算乘积&apos; );     </span><br><span class="line">    var a = 1;     </span><br><span class="line">    for ( var i = 0, l = arguments.length; i &lt; l; i++ )&#123;         </span><br><span class="line">        a = a * arguments[i];      </span><br><span class="line">    &#125;      </span><br><span class="line">    return a; </span><br><span class="line">&#125;; </span><br><span class="line">// 创建缓存代理的工厂 </span><br><span class="line">var createProxyFactory = function( fn )&#123;     </span><br><span class="line">    var cache = &#123;&#125;;     </span><br><span class="line">    return function()&#123;         </span><br><span class="line">        var args = Array.prototype.join.call( arguments, &apos;,&apos; );         </span><br><span class="line">        if ( args in cache )&#123;             </span><br><span class="line">            return cache[ args ];         </span><br><span class="line">            &#125;         </span><br><span class="line">        return  cache[ args ] = fn.apply( this, arguments );     </span><br><span class="line">    &#125; </span><br><span class="line">&#125;; </span><br><span class="line">var proxyMult = createProxyFactory( mult ), </span><br><span class="line"> proxyMult( 1, 2, 3, 4 );    // 输出：24  </span><br><span class="line"> proxyMult( 1, 2, 3, 4 );    // 输出：24</span><br></pre></td></tr></table></figure></p>
<p>扩展：用于ajax异步请求数据，下次请求相同数据时，是否可以取消请求，直接用之前缓存的数据，适用固定数据</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/designMode/strategies.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/designMode/strategies.html" itemprop="url">
                  策略模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-06T22:09:09+08:00">
                2018-11-06
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="主要思想"><a href="#主要思想" class="headerlink" title="主要思想"></a>主要思想</h1><p>定义一系列的算法，把它们一个个封装起来，通过逻辑函数使他们可以相互替换<br>避免if-else多分支判断</p>
<h1 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h1><p>定义一些系列算法（具体处理过程），把他们各自封装成策略类，算法被封装在策略类内部方法里。在客户对Context(如何调用算法的处理函数)发起请求时，Context总是把请求委托给这些策略对象中间的某一个进行计算</p>
<h1 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h1><p>编写代理函数时，注意如何调用，让算法得到<b>执行</b><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">let strategies = &#123; //算法集合</span><br><span class="line">	 &quot;S&quot;: function( salary )&#123; </span><br><span class="line">        return salary * 4;     </span><br><span class="line">		&#125;,</span><br><span class="line">     &quot;A&quot;: function( salary )&#123;</span><br><span class="line">         return salary * 3;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;B&quot;: function( salary )&#123;</span><br><span class="line">         return salary * 2;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;; </span><br><span class="line">var calculateBonus = function( level, salary )&#123; //Context,委托函数，负责调用哪个算法</span><br><span class="line">     return strategies[ level ]( salary ); </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">console.log( calculateBonus( &apos;S&apos;, 20000 ) );//80000</span><br><span class="line">console.log( calculateBonus( &apos;A&apos;, 10000 ) );//30000</span><br><span class="line"></span><br><span class="line">变形：</span><br><span class="line">var S = function( salary )&#123;      return salary * 4;  &#125;; </span><br><span class="line">var A = function( salary )&#123;     return salary * 3; &#125;; </span><br><span class="line">var B = function( salary )&#123;     return salary * 2; &#125;; </span><br><span class="line">var calculateBonus = function( func, salary )&#123;     return func( salary ); &#125;; </span><br><span class="line">calculateBonus( S, 10000  )</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">//具体策略方法</span><br><span class="line"> var strategies = &#123;             </span><br><span class="line">     isNonEmpty: function( value, errorMsg )&#123;                 </span><br><span class="line">         if ( value === &apos;&apos; )&#123;                     </span><br><span class="line">             return errorMsg;                 </span><br><span class="line">        &#125;             </span><br><span class="line">    &#125;,             </span><br><span class="line">    minLength: function( value, length, errorMsg )&#123;                 </span><br><span class="line">        if ( value.length &lt; length )&#123;                     </span><br><span class="line">            return errorMsg;                 </span><br><span class="line">        &#125;             </span><br><span class="line">    &#125;,             </span><br><span class="line">    isMobile: function( value, errorMsg )&#123;                 </span><br><span class="line">        if ( !/(^1[3|5|8][0-9]&#123;9&#125;$)/.test( value ) )&#123;                     </span><br><span class="line">            return errorMsg;                 </span><br><span class="line">        &#125;             </span><br><span class="line">    &#125;         </span><br><span class="line">&#125;; </span><br><span class="line">//执行代理 Context</span><br><span class="line"> var Validator = function()&#123;             </span><br><span class="line">        this.cache = [];         </span><br><span class="line">     &#125;; </span><br><span class="line"></span><br><span class="line">    Validator.prototype.add = function( dom, rules )&#123; </span><br><span class="line">        var self = this;</span><br><span class="line">        for ( var i = 0, rule; rule = rules[ i++ ]; )&#123;                 </span><br><span class="line">            (function( rule )&#123;                     </span><br><span class="line">                var strategyAry = rule.strategy.split( &apos;:&apos; );                     </span><br><span class="line">                var errorMsg = rule.errorMsg; </span><br><span class="line">                self.cache.push(function()&#123;                         </span><br><span class="line">                    var strategy = strategyAry.shift(); </span><br><span class="line">                    strategyAry.unshift( dom.value );                       </span><br><span class="line">                    strategyAry.push( errorMsg ); //strategyAry，传递到具体算法函数参数，这里进行处理          </span><br><span class="line">                    return strategies[ strategy ].apply( dom, strategyAry );                     </span><br><span class="line">                &#125;);                 </span><br><span class="line">            &#125;)( rule )             </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;; </span><br><span class="line">    Validator.prototype.start = function()&#123;             </span><br><span class="line">        for ( var i = 0, validatorFunc; validatorFunc = this.cache[ i++ ]; )&#123;                 </span><br><span class="line">            var errorMsg = validatorFunc();                 </span><br><span class="line">            if ( errorMsg )&#123;                     </span><br><span class="line">                return errorMsg;                 </span><br><span class="line">            &#125;             </span><br><span class="line">        &#125;         </span><br><span class="line">    &#125;;</span><br><span class="line">//具体应用</span><br><span class="line">    var registerForm = document.getElementById( &apos;registerForm&apos; ); </span><br><span class="line">    var validataFunc = function()&#123;             </span><br><span class="line">        var validator = new Validator(); </span><br><span class="line">        validator.add( registerForm.userName, [&#123;                 </span><br><span class="line">            strategy: &apos;isNonEmpty&apos;,                 </span><br><span class="line">            errorMsg: &apos;用户名不能为空&apos;             </span><br><span class="line">        &#125;, &#123;                 </span><br><span class="line">            strategy: &apos;minLength:6&apos;,                </span><br><span class="line">            errorMsg: &apos;用户名长度不能小于 10 位&apos;             </span><br><span class="line">        &#125;]); </span><br><span class="line">        validator.add( registerForm.password, [&#123;                 </span><br><span class="line">            strategy: &apos;minLength:6&apos;,                 </span><br><span class="line">            errorMsg: &apos;密码长度不能小于 6 位&apos;             </span><br><span class="line">        &#125;]); </span><br><span class="line">        validator.add( registerForm.phoneNumber, [&#123;                 </span><br><span class="line">            strategy: &apos;isMobile&apos;,                 </span><br><span class="line">            errorMsg: &apos;手机号码格式不正确&apos;             </span><br><span class="line">        &#125;]); </span><br><span class="line">        var errorMsg = validator.start();             </span><br><span class="line">        return errorMsg;         </span><br><span class="line">    &#125; </span><br><span class="line">    registerForm.onsubmit = function()&#123;                  </span><br><span class="line">        var errorMsg = validataFunc(); </span><br><span class="line">        if ( errorMsg )&#123;                   </span><br><span class="line">            alert ( errorMsg );                   </span><br><span class="line">            return false;              </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoohannah.github.io/post/designMode/singleInstance.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="YooHannah">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/psb.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="My Little World">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="My Little World" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/post/designMode/singleInstance.html" itemprop="url">
                  单例模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-04T23:11:09+08:00">
                2018-11-04
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>单例模式定义：保证一个类仅有一个实例，并提供一个访问它的全局访问点</p>
<p>主要思想&lt;通用惰性单例&gt;<br>管理单例逻辑（保证实现单例的过程）和创建过程（具体业务逻辑）分开，创建过程函数作为参数给到管理单例逻辑函数中，<br>通过调用单例逻辑函数，业务逻辑函数只执行一次</p>
<p>用途<br>1.创建单一对象<br>2.利用业务逻辑仅执行一次，进行事件挂载</p>
<p>注意事项<br>业务逻辑函数一定要return 一个真正</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">var getSingle = function(fn)&#123;</span><br><span class="line"> 	var ret;</span><br><span class="line"> 	return function()&#123;</span><br><span class="line"> 		return ret || (ret = fn.apply(this,arguments));</span><br><span class="line"> 		//第一次执行时，会运行函数，返回创建的实例给到ret,</span><br><span class="line"> 		//以后再执行时，ret 即第一次创建的实例直接返回</span><br><span class="line"> 	&#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> //返回单例</span><br><span class="line"> var creatObj = function(name)&#123;</span><br><span class="line"> 	this.aaaa = &#123;</span><br><span class="line">		name:name,</span><br><span class="line">		getName:function()&#123;console.log(this)&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return this </span><br><span class="line"> &#125;</span><br><span class="line">var creatObj1 = getSingle(creatObj)</span><br><span class="line">var obj = creatObj1(&apos;aaa&apos;)</span><br><span class="line">console.log(obj)  //返回window 对象(满足全局可访问)，带有aaaa属性，值为字面量对象</span><br><span class="line">obj.aaaa.getName()//&#123;name: &quot;kitty&quot;, getName: ƒ&#125;</span><br><span class="line"></span><br><span class="line">var obj1 = creatObj1(&apos;aaa&apos;)</span><br><span class="line">console.log(obj=== obj1) //true</span><br><span class="line"></span><br><span class="line">obj1.aaaa.getName() //&#123;name: &quot;kitty&quot;, getName: ƒ&#125;</span><br><span class="line"></span><br><span class="line">//事件仅挂载一次</span><br><span class="line"></span><br><span class="line">var bindEvent = getSingle(function()&#123;</span><br><span class="line">	document.getElementById(&apos;div1&apos;).onclick = function()&#123;</span><br><span class="line">		console.log(&apos;click&apos;)</span><br><span class="line">	&#125;</span><br><span class="line">	return true //保证只执行一次</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">var render = function()&#123;</span><br><span class="line">	console.log(&apos;开始渲染&apos;)；</span><br><span class="line">	bindEvent()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render()</span><br><span class="line">render()</span><br><span class="line">render()</span><br><span class="line">//渲染多次，div1只挂载一次事件</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/psb.jpg" alt="YooHannah">
          <p class="site-author-name" itemprop="name">YooHannah</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">245</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YooHannah</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/treedocument/treedocument.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
